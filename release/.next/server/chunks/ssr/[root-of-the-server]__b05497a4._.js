module.exports=[193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},650645,a=>{a.n(a.i(827572))},262530,a=>{a.n(a.i(688848))},409171,a=>{a.n(a.i(753004))},21802,a=>{a.n(a.i(277152))},155517,a=>{a.n(a.i(298906))},444067,a=>{a.n(a.i(436102))},5408,a=>{"use strict";let b=(0,a.i(976286).registerClientReference)(function(){throw Error("Attempted to call MonthPicker() from the server but MonthPicker is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/month-picker/month-picker.tsx <module evaluation>","MonthPicker");a.s(["MonthPicker",0,b])},897710,a=>{"use strict";let b=(0,a.i(976286).registerClientReference)(function(){throw Error("Attempted to call MonthPicker() from the server but MonthPicker is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/month-picker/month-picker.tsx","MonthPicker");a.s(["MonthPicker",0,b])},868313,a=>{"use strict";a.i(5408);var b=a.i(897710);a.n(b)},56672,a=>{"use strict";a.i(868313),a.s([])},795661,a=>{"use strict";let b=(0,a.i(976286).registerClientReference)(function(){throw Error("Attempted to call UnitFilter() from the server but UnitFilter is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/admin/reports/unit-filter/unit-filter.tsx <module evaluation>","UnitFilter");a.s(["UnitFilter",0,b])},52347,a=>{"use strict";let b=(0,a.i(976286).registerClientReference)(function(){throw Error("Attempted to call UnitFilter() from the server but UnitFilter is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/admin/reports/unit-filter/unit-filter.tsx","UnitFilter");a.s(["UnitFilter",0,b])},790993,a=>{"use strict";a.i(795661);var b=a.i(52347);a.n(b)},23677,a=>{"use strict";a.i(790993),a.s([])},353332,a=>{"use strict";let b=(0,a.i(976286).registerClientReference)(function(){throw Error("Attempted to call ProfessionalFilter() from the server but ProfessionalFilter is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/admin/reports/professional-filter/professional-filter.tsx <module evaluation>","ProfessionalFilter");a.s(["ProfessionalFilter",0,b])},731475,a=>{"use strict";let b=(0,a.i(976286).registerClientReference)(function(){throw Error("Attempted to call ProfessionalFilter() from the server but ProfessionalFilter is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/admin/reports/professional-filter/professional-filter.tsx","ProfessionalFilter");a.s(["ProfessionalFilter",0,b])},491308,a=>{"use strict";a.i(353332);var b=a.i(731475);a.n(b)},94623,a=>{"use strict";var b=a.i(623127),c=a.i(468695),d=a.i(766518),e=a.i(169513),f=a.i(28792);a.i(56672);var g=a.i(868313);a.i(23677);var h=a.i(790993),i=a.i(638904),j=a.i(139138),k=a.i(303223),l=a.i(491308);let m="America/Sao_Paulo",n="admin_unit_context";function o(a){let b=new Intl.DateTimeFormat("pt-BR",{timeZone:m,year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(a),c=Number(b.find(a=>"day"===a.type)?.value??"1"),d=Number(b.find(a=>"month"===a.type)?.value??"1");return{y:Number(b.find(a=>"year"===a.type)?.value??"1970"),m:d,d:c}}async function p(a){if(!a.canSeeAllUnits)return a.unitId;let b=await (0,e.cookies)(),c=b.get(n)?.value??"all";return c&&"all"!==c?c:null}function q(a){return a?{unitId:a}:{}}function r(a){let b=new Intl.DateTimeFormat("pt-BR",{timeZone:m,hour:"2-digit",hour12:!1}).formatToParts(a),c=Number(b.find(a=>"hour"===a.type)?.value??"0");return Number.isFinite(c)?c:0}let s=["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"];function t(a,b,c){return Math.min(c,Math.max(b,a))}function u(a,b){let c=b[0]??8,d=b[b.length-1]??20,e=new Map;for(let a=0;a<=6;a++)e.set(a,new Map);let f=0;for(let b of a){let a=function(a){let b=new Intl.DateTimeFormat("pt-BR",{timeZone:m,year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(a),c=Number(b.find(a=>"day"===a.type)?.value??"1"),d=Number(b.find(a=>"month"===a.type)?.value??"1");return new Date(Number(b.find(a=>"year"===a.type)?.value??"1970"),d-1,c).getDay()}(b.scheduleAt),g=r(b.scheduleAt);if(g<c||g>d)continue;let h=e.get(a);h.set(g,(h.get(g)??0)+1),f+=1}let g=0,h=null;for(let a=0;a<=6;a++){let c=e.get(a);for(let d of b){let b=c.get(d)??0;b>g&&(g=b),(!h||b>h.count)&&(h={wd:a,h:d,count:b})}}return{heatmap:e,totalCount:f,maxCell:g,bestSlotLabel:h&&h.count>0?`${s[h.wd]} \xb7 ${String(h.h).padStart(2,"0")}:00 (${h.count})`:"—"}}function v(a){if(null!=a)return Array.isArray(a)?a[0]:a}async function w({searchParams:a}){let m=await (0,f.requireAdminForModule)("REPORTS"),w=String(m?.companyId??"").trim();if(!w)throw Error("companyId ausente no contexto do admin (session.companyId).");if(!m?.canSeeAllUnits&&!m?.unitId)throw Error("Admin de unidade sem unitId definido. Vincule este admin a uma unidade.");let x=await (0,e.cookies)(),y=x.get(n)?.value??"all",z=m?.canSeeAllUnits?y:m?.unitId??"",A=await p({unitId:m?.unitId??null,canSeeAllUnits:!!m?.canSeeAllUnits}),B=await a,C=v(B.month),D=v(B.professionalId)??v(B.barberId),E=v(B.compareProfessionalId)??v(B.compareBarberId),F=C?(0,k.parse)(C,"yyyy-MM",new Date):new Date,G=function(a){let{y:b,m:c}=o(a);return new Date(Date.UTC(b,c-1,1,3,0,0))}(F),H=function(a){let{y:b,m:c}=o(a);return new Date(new Date(Date.UTC(b,c,1,3,0,0)).getTime()-1)}(F),I=[],J=null;if(m?.canSeeAllUnits)I=await d.prisma.unit.findMany({where:{companyId:w,isActive:!0},select:{id:!0,name:!0},orderBy:{name:"asc"}});else if(m?.unitId){let a=await d.prisma.unit.findFirst({where:{id:m.unitId,companyId:w},select:{name:!0}});J=a?.name??null}let K=!!m?.canSeeAllUnits&&I.length>1,L=m?.canSeeAllUnits&&1===I.length?I[0]?.name:null,M=m?.canSeeAllUnits?L??"Todas as unidades":J??"",N=A?await d.prisma.professional.findMany({where:{companyId:w,isActive:!0,units:{some:{unitId:A,isActive:!0}}},select:{id:!0,name:!0},orderBy:{name:"asc"}}):await d.prisma.professional.findMany({where:{companyId:w,isActive:!0},select:{id:!0,name:!0},orderBy:{name:"asc"}}),O=D&&N.some(a=>a.id===D)?D:null,P=E&&E!==O&&N.some(a=>a.id===E)?E:null,Q=["PENDING","DONE"],[R,S]=await Promise.all([d.prisma.appointment.findMany({where:{companyId:w,scheduleAt:{gte:G,lte:H},status:{in:Q},...q(A),...O?{professionalId:O}:{}},select:{scheduleAt:!0}}),P?d.prisma.appointment.findMany({where:{companyId:w,scheduleAt:{gte:G,lte:H},status:{in:Q},...q(A),professionalId:P},select:{scheduleAt:!0}}):Promise.resolve([])]),T=!!P,U=8,V=20,W=T?[...R,...S]:R;if(W.length>0){let a=W.map(a=>r(a.scheduleAt)),b=Math.min(...a),c=Math.max(...a);U=t(b,6,22),(V=t(c,6,22))-U<6&&(U=t(U-2,6,22),V=t(V+2,6,22))}let X=Array.from({length:V-U+1},(a,b)=>U+b),Y=u(R,X),Z=u(S,X),$=T?Math.max(Y.maxCell,Z.maxCell):Y.maxCell,_=T?Y.totalCount+Z.totalCount:Y.totalCount,aa=O?N.find(a=>a.id===O)?.name:null,ab=P?N.find(a=>a.id===P)?.name:null,ac=(()=>{if(!T)return Y.bestSlotLabel;if("—"===Y.bestSlotLabel&&"—"===Z.bestSlotLabel)return"—";let a=null;for(let b=0;b<=6;b++){let c=Y.heatmap.get(b),d=Z.heatmap.get(b);for(let e of X){let f=(c.get(e)??0)+(d.get(e)??0);(!a||f>a.count)&&(a={wd:b,h:e,count:f})}}return!a||a.count<=0?"—":`${s[a.wd]} \xb7 ${String(a.h).padStart(2,"0")}:00 (${a.count})`})();function ad({title:a,subtitle:c,heatmap:d,maxCell:e}){return(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-label-large text-content-primary",children:a}),c?(0,b.jsx)("p",{className:"text-paragraph-small text-content-tertiary",children:c}):null]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-[11px] text-content-tertiary",children:[(0,b.jsx)("span",{children:"menos"}),(0,b.jsx)("span",{className:"h-3 w-6 rounded border border-border-primary bg-background-secondary"}),(0,b.jsx)("span",{className:"h-3 w-6 rounded border border-emerald-500/20 bg-emerald-500/10"}),(0,b.jsx)("span",{className:"h-3 w-6 rounded border border-emerald-500/30 bg-emerald-500/20"}),(0,b.jsx)("span",{className:"h-3 w-6 rounded border border-emerald-500/40 bg-emerald-500/30"}),(0,b.jsx)("span",{children:"mais"})]})]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"min-w-full text-left text-[12px]",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-border-primary text-content-secondary",children:[(0,b.jsx)("th",{className:"py-2 pr-3",children:"Dia"}),X.map(a=>(0,b.jsxs)("th",{className:"py-2 px-2 text-center font-medium",children:[String(a).padStart(2,"0"),"h"]},a))]})}),(0,b.jsx)("tbody",{children:s.map((a,c)=>{let f=d.get(c);return(0,b.jsxs)("tr",{className:"border-b border-border-primary/60 last:border-0",children:[(0,b.jsx)("td",{className:"py-2 pr-3 text-content-primary font-medium whitespace-nowrap",children:a}),X.map(c=>{let d=f.get(c)??0,g=function(a,b){if(b<=0||a<=0)return"bg-background-secondary text-content-tertiary border-border-primary";let c=a/b;return c<=.2?"bg-emerald-500/10 text-content-primary border-emerald-500/20":c<=.4?"bg-emerald-500/15 text-content-primary border-emerald-500/25":c<=.6?"bg-emerald-500/20 text-content-primary border-emerald-500/30":c<=.8?"bg-emerald-500/25 text-content-primary border-emerald-500/35":"bg-emerald-500/30 text-content-primary border-emerald-500/40"}(d,e);return(0,b.jsx)("td",{className:"py-1 px-1",children:(0,b.jsx)("div",{className:(0,j.cn)("h-9 rounded-md border flex items-center justify-center","transition-colors",g),title:`${a} \xb7 ${String(c).padStart(2,"0")}:00 → ${d}`,children:(0,b.jsx)("span",{className:"tabular-nums",children:d>0?d:"·"})})},c)})]},a)})})]})})]})}return(0,b.jsxs)("div",{className:"space-y-6 max-w-7xl",children:[(0,b.jsxs)("header",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsx)("div",{className:"space-y-1",children:(0,b.jsx)("h1",{className:"text-title text-content-primary",children:"Ocupação da agenda"})}),(0,b.jsx)(i.Button,{variant:"outline",asChild:!0,children:(0,b.jsx)(c.default,{href:"/admin/report",children:"Voltar"})})]}),(0,b.jsxs)("div",{className:(0,j.cn)("rounded-xl border border-border-primary bg-background-tertiary p-3"),children:[(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-[1fr_1fr_1fr_auto] md:items-end",children:[(0,b.jsx)("div",{className:"w-full [&_select]:h-12 [&_select]:min-h-12 [&_select]:py-2",children:K?(0,b.jsx)(h.UnitFilter,{units:I,value:z}):(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-label-small text-content-secondary",children:"Unidade"}),(0,b.jsx)("div",{className:(0,j.cn)("h-12 w-full rounded-md border border-border-primary","bg-background-secondary px-3","flex items-center","text-content-primary text-sm"),title:M,children:(0,b.jsx)("span",{className:"truncate",children:M})})]})}),(0,b.jsx)("div",{className:"w-full [&_select]:h-12 [&_select]:min-h-12 [&_select]:py-2",children:(0,b.jsx)(l.ProfessionalFilter,{professionals:N,value:O,paramKey:"professionalId",label:"Profissional"})}),(0,b.jsx)("div",{className:"w-full [&_select]:h-12 [&_select]:min-h-12 [&_select]:py-2",children:(0,b.jsx)(l.ProfessionalFilter,{professionals:N,value:P,paramKey:"compareProfessionalId",label:"Comparar com"})}),(0,b.jsx)("div",{className:"justify-self-end",children:(0,b.jsx)(g.MonthPicker,{})})]}),(0,b.jsx)("p",{className:"mt-2 text-[11px] text-content-tertiary",children:"Dica: compare dois profissionais para achar gargalos e oportunidades de encaixe."})]})]}),(0,b.jsxs)("section",{className:"grid gap-4 md:grid-cols-3",children:[(0,b.jsxs)("div",{className:"rounded-xl border border-border-primary bg-background-tertiary px-4 py-3",children:[(0,b.jsx)("p",{className:"text-label-small text-content-secondary",children:"Agendamentos contados (mês)"}),(0,b.jsx)("p",{className:"text-title text-content-primary",children:_}),T?(0,b.jsxs)("p",{className:"mt-1 text-[11px] text-content-tertiary",children:[aa??"Profissional A",":"," ",Y.totalCount," •"," ",ab??"Profissional B",":"," ",Z.totalCount]}):null]}),(0,b.jsxs)("div",{className:"rounded-xl border border-border-primary bg-background-tertiary px-4 py-3",children:[(0,b.jsx)("p",{className:"text-label-small text-content-secondary",children:"Slot mais concorrido"}),(0,b.jsx)("p",{className:"text-paragraph-medium-size text-content-primary",children:ac}),T?(0,b.jsxs)("p",{className:"mt-1 text-[11px] text-content-tertiary",children:["A: ",Y.bestSlotLabel," • B: ",Z.bestSlotLabel]}):null]}),(0,b.jsxs)("div",{className:"rounded-xl border border-border-primary bg-background-tertiary px-4 py-3",children:[(0,b.jsx)("p",{className:"text-label-small text-content-secondary",children:"Faixa"}),(0,b.jsxs)("p",{className:"text-paragraph-medium-size text-content-primary",children:[String(U).padStart(2,"0"),":00 até"," ",String(V).padStart(2,"0"),":00"]}),T?(0,b.jsx)("p",{className:"mt-1 text-[11px] text-content-tertiary",children:"Faixa alinhada para comparação justa"}):null]})]}),(0,b.jsx)("section",{className:"rounded-xl border border-border-primary bg-background-tertiary p-4",children:T?(0,b.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,b.jsx)(ad,{title:aa??"Profissional A",subtitle:"Mesmo eixo de horas para comparar direto.",heatmap:Y.heatmap,maxCell:$}),(0,b.jsx)(ad,{title:ab??"Profissional B",subtitle:"A intensidade usa a mesma escala do outro lado.",heatmap:Z.heatmap,maxCell:$})]}):(0,b.jsx)(ad,{title:"Heatmap",subtitle:"Linhas = dia da semana • colunas = hora • célula = quantidade",heatmap:Y.heatmap,maxCell:$})})]})}a.s(["default",()=>w,"dynamic",0,"force-dynamic","metadata",0,{title:"Admin | Relatórios"}])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__b05497a4._.js.map