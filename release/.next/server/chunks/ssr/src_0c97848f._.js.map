{"version":3,"sources":["turbopack:///[project]/src/components/admin/reports/retention-window-filter/retention-window-filter.tsx/__nextjs-internal-proxy.mjs","turbopack:///[project]/src/app/admin/report/retention/page.tsx","turbopack:///[project]/src/components/admin/reports/professional-filter/index.ts","turbopack:///[project]/src/components/admin/reports/retention-window-filter/index.ts"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const RetentionWindowFilter = registerClientReference(\n    function() { throw new Error(\"Attempted to call RetentionWindowFilter() from the server but RetentionWindowFilter is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/admin/reports/retention-window-filter/retention-window-filter.tsx\",\n    \"RetentionWindowFilter\",\n);\n","// app/admin/reports/retention/page.tsx\nimport type { Metadata } from 'next';\nimport Link from 'next/link';\nimport { prisma } from '@/lib/prisma';\nimport { cookies } from 'next/headers';\nimport { requireAdminForModule } from '@/lib/admin-permissions';\nimport { MonthPicker } from '@/components/month-picker';\nimport { ProfessionalFilter } from '@/components/admin/reports/professional-filter';\nimport { UnitFilter } from '@/components/admin/reports/unit-filter';\nimport { CompareWithFilter } from '@/components/admin/reports/compare-with-filter';\nimport { RetentionWindowFilter } from '@/components/admin/reports/retention-window-filter';\nimport { Button } from '@/components/ui/button';\nimport { cn } from '@/lib/utils';\nimport {\n    parse,\n    addDays,\n    differenceInCalendarDays,\n    subMonths,\n    subYears,\n    format,\n} from 'date-fns';\nimport { ptBR } from 'date-fns/locale';\nimport type { AppointmentStatus } from '@prisma/client';\nimport { redirect } from 'next/navigation';\n\nexport const dynamic = 'force-dynamic';\n\nexport const metadata: Metadata = {\n    title: 'Admin | RelatÃ³rios',\n};\n\ntype AdminReportsRetentionPageProps = {\n    searchParams: Promise<{\n        month?: string; // yyyy-MM\n        professionalId?: string;\n        compare?: string; // \"prev_month\" | \"prev_year\"\n        window?: string; // \"30\" | \"60\" | \"90\"\n    }>;\n};\n\nconst SAO_PAULO_TIMEZONE = 'America/Sao_Paulo';\nconst UNIT_COOKIE_NAME = 'admin_unit_context';\nconst UNIT_ALL_VALUE = 'all';\nconst COMPANY_COOKIE_NAME = 'admin_company_context';\n\n// ===============================\n// âœ… Company resolver (sem te jogar pro login)\n// ===============================\nasync function resolveCompanyIdOrThrow(admin: any): Promise<string> {\n    const cookieStore = await cookies();\n    const fromCookie = cookieStore.get(COMPANY_COOKIE_NAME)?.value;\n    if (fromCookie) return fromCookie;\n\n    const fromAdmin =\n        (typeof admin?.companyId === 'string' && admin.companyId) ||\n        (typeof admin?.company?.id === 'string' && admin.company.id);\n    if (fromAdmin) return fromAdmin;\n\n    const userId =\n        (typeof admin?.userId === 'string' && admin.userId) ||\n        (typeof admin?.id === 'string' && admin.id) ||\n        (typeof admin?.sub === 'string' && admin.sub);\n\n    if (!userId) {\n        throw new Error(\n            'NÃ£o consegui resolver o userId do admin para achar a company.'\n        );\n    }\n\n    const membership = await prisma.companyMember.findFirst({\n        where: { userId, isActive: true },\n        select: { companyId: true },\n        orderBy: { createdAt: 'asc' } as any,\n    });\n\n    if (!membership?.companyId) {\n        throw new Error(\n            `Company nÃ£o definida para este admin. (cookie \"${COMPANY_COOKIE_NAME}\" ausente e sem membership ativa).`\n        );\n    }\n\n    return membership.companyId;\n}\n\n// ===============================\n// Timezone helpers (SP)\n// ===============================\nfunction getSaoPauloYMD(date: Date): { y: number; m: number; d: number } {\n    const formatter = new Intl.DateTimeFormat('pt-BR', {\n        timeZone: SAO_PAULO_TIMEZONE,\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit',\n    });\n\n    const parts = formatter.formatToParts(date);\n    const d = Number(parts.find((p) => p.type === 'day')?.value ?? '1');\n    const m = Number(parts.find((p) => p.type === 'month')?.value ?? '1');\n    const y = Number(parts.find((p) => p.type === 'year')?.value ?? '1970');\n\n    return { y, m, d };\n}\n\n// 00:00 em SP (UTC-03) = 03:00 UTC\nfunction startOfMonthSP(date: Date): Date {\n    const { y, m } = getSaoPauloYMD(date);\n    return new Date(Date.UTC(y, m - 1, 1, 3, 0, 0));\n}\n\nfunction endOfMonthSP(date: Date): Date {\n    const { y, m } = getSaoPauloYMD(date);\n    const nextMonth = new Date(Date.UTC(y, m, 1, 3, 0, 0));\n    return new Date(nextMonth.getTime() - 1);\n}\n\n// ===============================\n// Unidade (mesma regra dos outros)\n// ===============================\nasync function resolveUnitScope(admin: {\n    unitId: string | null;\n    canSeeAllUnits: boolean;\n}) {\n    if (!admin.canSeeAllUnits) return admin.unitId;\n\n    const cookieStore = await cookies();\n    const cookieValue =\n        cookieStore.get(UNIT_COOKIE_NAME)?.value ?? UNIT_ALL_VALUE;\n\n    if (!cookieValue || cookieValue === UNIT_ALL_VALUE) return null;\n    return cookieValue;\n}\n\nfunction whereAppointmentUnit(unitId: string | null) {\n    return unitId ? { unitId } : {};\n}\n\ntype UnitOption = { id: string; name: string };\n\ntype CompareMode = 'prev_month' | 'prev_year';\n\nfunction safeCompareMode(raw?: string): CompareMode {\n    return raw === 'prev_year' ? 'prev_year' : 'prev_month';\n}\n\nfunction compareLabel(mode: CompareMode) {\n    return mode === 'prev_year' ? 'ano anterior' : 'mÃªs anterior';\n}\n\ntype WindowDays = 30 | 60 | 90;\n\nfunction safeWindowDays(raw?: string): WindowDays {\n    const n = Number(raw);\n    if (n === 60) return 60;\n    if (n === 90) return 90;\n    return 30;\n}\n\nfunction formatPercent(value: number) {\n    if (!Number.isFinite(value)) return 'â€”';\n    return `${Math.round(value)}%`;\n}\n\nfunction formatSignedInt(n: number) {\n    const sign = n > 0 ? '+' : '';\n    return `${sign}${n}`;\n}\n\nfunction formatSignedPP(pp: number) {\n    const sign = pp > 0 ? '+' : '';\n    return `${sign}${Math.round(pp)} p.p.`;\n}\n\ntype FirstByClientRow = {\n    clientId: string | null;\n    _min: { scheduleAt: Date | null };\n};\n\ntype CohortItem = { clientId: string; firstAt: Date };\n\ntype RetentionCurveRow = {\n    day: number; // 0..windowDays\n    count: number;\n    cumulativeCount: number;\n    cumulativePct: number; // 0..100\n};\n\nfunction buildCurve(args: {\n    dayCounts: number[];\n    cohortSize: number;\n    maxDay: number;\n}) {\n    const rows: RetentionCurveRow[] = [];\n    let cum = 0;\n\n    for (let day = 0; day <= args.maxDay; day++) {\n        const c = args.dayCounts[day] ?? 0;\n        cum += c;\n        const pct = args.cohortSize > 0 ? (cum / args.cohortSize) * 100 : 0;\n\n        rows.push({\n            day,\n            count: c,\n            cumulativeCount: cum,\n            cumulativePct: pct,\n        });\n    }\n\n    return rows;\n}\n\nasync function computeRetentionFromCohort(args: {\n    companyId: string;\n    cohort: CohortItem[];\n    unitId: string | null;\n    professionalId: string | null;\n    windowDays: WindowDays;\n}) {\n    const DONE_ONLY: AppointmentStatus[] = ['DONE'];\n    const cohortClientIds = args.cohort.map((c) => c.clientId);\n\n    if (cohortClientIds.length === 0) {\n        return {\n            cohortSize: 0,\n            retainedCount: 0,\n            lostCount: 0,\n            retentionPct: NaN,\n            avgReturnDays: NaN,\n            dayCounts: Array.from({ length: args.windowDays + 1 }, () => 0),\n        };\n    }\n\n    const firstAts = args.cohort.map((c) => c.firstAt.getTime());\n    const minFirst = new Date(Math.min(...firstAts) + 1); // evita contar o mesmo evento\n    const maxFirst = new Date(Math.max(...firstAts));\n    const maxWindowEnd = addDays(maxFirst, args.windowDays);\n\n    const followups = await prisma.appointment.findMany({\n        where: {\n            companyId: args.companyId,\n            clientId: { in: cohortClientIds },\n            status: { in: DONE_ONLY },\n            scheduleAt: { gt: minFirst, lte: maxWindowEnd },\n            ...whereAppointmentUnit(args.unitId),\n            ...(args.professionalId\n                ? { professionalId: args.professionalId }\n                : {}),\n        },\n        select: { clientId: true, scheduleAt: true },\n        orderBy: { scheduleAt: 'asc' },\n    });\n\n    const followupsByClient = new Map<string, Date[]>();\n    for (const f of followups) {\n        if (!f.clientId) continue;\n        const arr = followupsByClient.get(f.clientId) ?? [];\n        arr.push(f.scheduleAt);\n        followupsByClient.set(f.clientId, arr);\n    }\n\n    let retainedCount = 0;\n    const returnDays: number[] = [];\n    const dayCounts = Array.from({ length: args.windowDays + 1 }, () => 0);\n\n    for (const c of args.cohort) {\n        const windowEnd = addDays(c.firstAt, args.windowDays);\n        const list = followupsByClient.get(c.clientId) ?? [];\n\n        const firstReturn = list.find(\n            (d) =>\n                d.getTime() > c.firstAt.getTime() &&\n                d.getTime() <= windowEnd.getTime()\n        );\n\n        if (firstReturn) {\n            retainedCount += 1;\n\n            const day = differenceInCalendarDays(firstReturn, c.firstAt);\n            returnDays.push(day);\n\n            const safeDay = Math.max(0, Math.min(args.windowDays, day));\n            dayCounts[safeDay] = (dayCounts[safeDay] ?? 0) + 1;\n        }\n    }\n\n    const cohortSize = args.cohort.length;\n    const lostCount = cohortSize - retainedCount;\n    const retentionPct =\n        cohortSize > 0 ? (retainedCount / cohortSize) * 100 : NaN;\n\n    const avgReturnDays =\n        returnDays.length > 0\n            ? returnDays.reduce((a, b) => a + b, 0) / returnDays.length\n            : NaN;\n\n    return {\n        cohortSize,\n        retainedCount,\n        lostCount,\n        retentionPct,\n        avgReturnDays,\n        dayCounts,\n    };\n}\n\ntype BarberRetentionRow = {\n    professionalId: string;\n    professionalName: string;\n    cohortSize: number;\n    retainedCount: number;\n    lostCount: number;\n    retentionPct: number; // NaN ok\n    avgReturnDays: number; // NaN ok\n};\n\nexport default async function AdminReportsRetentionPage({\n    searchParams,\n}: AdminReportsRetentionPageProps) {\n    const admin = (await requireAdminForModule('REPORTS')) as any;\n\n    // âœ… resolve companyId sem depender do cookie\n    const companyId = await resolveCompanyIdOrThrow(admin);\n\n    const cookieStore = await cookies();\n\n    if (!admin?.canSeeAllUnits && !admin?.unitId) {\n        throw new Error(\n            'Admin de unidade sem unitId definido. Vincule este admin a uma unidade.'\n        );\n    }\n\n    const unitCookieValue =\n        cookieStore.get(UNIT_COOKIE_NAME)?.value ?? UNIT_ALL_VALUE;\n\n    const selectedUnitValue = admin?.canSeeAllUnits\n        ? unitCookieValue\n        : (admin?.unitId ?? '');\n\n    const activeUnitId = await resolveUnitScope({\n        unitId: admin?.unitId ?? null,\n        canSeeAllUnits: !!admin?.canSeeAllUnits,\n    });\n\n    // Sanity check: se tiver unidade ativa, valida que Ã© da company\n    if (activeUnitId) {\n        const ok = await prisma.unit.findFirst({\n            where: { id: activeUnitId, companyId, isActive: true },\n            select: { id: true },\n        });\n        if (!ok) redirect('/admin/reports');\n    }\n\n    const {\n        month: monthParam,\n        professionalId,\n        compare,\n        window,\n    } = await searchParams;\n\n    const compareMode = safeCompareMode(compare);\n    const windowDays = safeWindowDays(window);\n\n    const referenceDate = monthParam\n        ? parse(monthParam, 'yyyy-MM', new Date())\n        : new Date();\n\n    const compareDate =\n        compareMode === 'prev_year'\n            ? subYears(referenceDate, 1)\n            : subMonths(referenceDate, 1);\n\n    const monthStart = startOfMonthSP(referenceDate);\n    const monthEnd = endOfMonthSP(referenceDate);\n\n    const compareStart = startOfMonthSP(compareDate);\n    const compareEnd = endOfMonthSP(compareDate);\n\n    const monthLabel = format(referenceDate, \"MMMM 'de' yyyy\", {\n        locale: ptBR,\n    });\n\n    // ===== Unidades (para filtro)\n    let units: UnitOption[] = [];\n    let fixedUnitName: string | null = null;\n\n    if (admin?.canSeeAllUnits) {\n        units = await prisma.unit.findMany({\n            where: { companyId, isActive: true },\n            select: { id: true, name: true },\n            orderBy: { name: 'asc' },\n        });\n    } else if (admin?.unitId) {\n        const u = await prisma.unit.findFirst({\n            where: { id: admin.unitId, companyId },\n            select: { name: true },\n        });\n        fixedUnitName = u?.name ?? null;\n    }\n\n    const ownerHasMultipleUnits = !!admin?.canSeeAllUnits && units.length > 1;\n    const ownerSingleUnitName =\n        !!admin?.canSeeAllUnits && units.length === 1 ? units[0]?.name : null;\n\n    const unitLabel = admin?.canSeeAllUnits\n        ? (ownerSingleUnitName ?? 'Todas as unidades')\n        : (fixedUnitName ?? '');\n\n    // ===== Barbeiros (jÃ¡ respeita unidade selecionada)\n    const professionals = activeUnitId\n        ? await prisma.professional.findMany({\n              where: {\n                  companyId,\n                  isActive: true,\n                  units: { some: { unitId: activeUnitId, isActive: true } },\n              },\n              select: { id: true, name: true },\n              orderBy: { name: 'asc' },\n          })\n        : await prisma.professional.findMany({\n              where: { companyId, isActive: true },\n              select: { id: true, name: true },\n              orderBy: { name: 'asc' },\n          });\n\n    const professionalIdSafe =\n        professionalId && professionals.some((b) => b.id === professionalId)\n            ? professionalId\n            : null;\n\n    const selectedProfessionalName = professionalIdSafe\n        ? professionals.find((b) => b.id === professionalIdSafe)?.name\n        : null;\n\n    // ===============================\n    // KPI engine (topo do relatÃ³rio)\n    // ===============================\n    const DONE_ONLY: AppointmentStatus[] = ['DONE'];\n\n    const firstByClient = (await prisma.appointment.groupBy({\n        by: ['clientId'],\n        where: {\n            companyId,\n            status: { in: DONE_ONLY },\n            ...whereAppointmentUnit(activeUnitId),\n            ...(professionalIdSafe\n                ? { professionalId: professionalIdSafe }\n                : {}),\n        },\n        _min: { scheduleAt: true },\n    })) as unknown as FirstByClientRow[];\n\n    const rows = firstByClient\n        .filter((r) => r.clientId && r._min.scheduleAt)\n        .map((r) => ({\n            clientId: r.clientId as string,\n            firstAt: r._min.scheduleAt as Date,\n        }));\n\n    const newClientsBase: CohortItem[] = rows.filter(\n        (r) => r.firstAt >= monthStart && r.firstAt <= monthEnd\n    );\n\n    const newClientsCompare: CohortItem[] = rows.filter(\n        (r) => r.firstAt >= compareStart && r.firstAt <= compareEnd\n    );\n\n    const [baseKpis, compareKpis] = await Promise.all([\n        computeRetentionFromCohort({\n            companyId,\n            cohort: newClientsBase,\n            unitId: activeUnitId,\n            professionalId: professionalIdSafe,\n            windowDays,\n        }),\n        computeRetentionFromCohort({\n            companyId,\n            cohort: newClientsCompare,\n            unitId: activeUnitId,\n            professionalId: professionalIdSafe,\n            windowDays,\n        }),\n    ]);\n\n    const retentionRateLabel = formatPercent(baseKpis.retentionPct);\n    const retainedCount = baseKpis.retainedCount;\n    const lostCount = baseKpis.lostCount;\n    const avgReturnDaysLabel = Number.isFinite(baseKpis.avgReturnDays)\n        ? `${Math.round(baseKpis.avgReturnDays)} dias`\n        : 'â€”';\n\n    const retentionDeltaPP =\n        Number.isFinite(baseKpis.retentionPct) &&\n        Number.isFinite(compareKpis.retentionPct)\n            ? baseKpis.retentionPct - compareKpis.retentionPct\n            : NaN;\n\n    const retainedDelta = retainedCount - (compareKpis.retainedCount ?? 0);\n    const lostDelta = lostCount - (compareKpis.lostCount ?? 0);\n\n    const avgDaysDelta =\n        Number.isFinite(baseKpis.avgReturnDays) &&\n        Number.isFinite(compareKpis.avgReturnDays)\n            ? baseKpis.avgReturnDays - compareKpis.avgReturnDays\n            : NaN;\n\n    const curveRows = buildCurve({\n        dayCounts: baseKpis.dayCounts,\n        cohortSize: baseKpis.cohortSize,\n        maxDay: windowDays,\n    });\n\n    const maxDayCount = Math.max(...baseKpis.dayCounts, 0);\n\n    // ===============================\n    // Clientes em risco\n    // ===============================\n    const now = new Date();\n    const baseIds = newClientsBase.map((c) => c.clientId);\n\n    let riskRows: Array<{\n        clientId: string;\n        name: string | null;\n        phone: string | null;\n        firstAt: Date;\n        daysSinceFirst: number;\n        daysLeftToWindow: number;\n        isOverdue: boolean;\n    }> = [];\n\n    if (baseIds.length > 0) {\n        const firstAts = newClientsBase.map((c) => c.firstAt.getTime());\n        const minFirst = new Date(Math.min(...firstAts) + 1);\n        const maxFirst = new Date(Math.max(...firstAts));\n        const maxWindowEnd = addDays(maxFirst, windowDays);\n\n        const followups = await prisma.appointment.findMany({\n            where: {\n                companyId,\n                clientId: { in: baseIds },\n                status: { in: DONE_ONLY },\n                scheduleAt: { gt: minFirst, lte: maxWindowEnd },\n                ...whereAppointmentUnit(activeUnitId),\n                ...(professionalIdSafe\n                    ? { professionalId: professionalIdSafe }\n                    : {}),\n            },\n            select: { clientId: true, scheduleAt: true },\n            orderBy: { scheduleAt: 'asc' },\n        });\n\n        const firstReturnByClient = new Map<string, Date>();\n        for (const f of followups) {\n            if (!f.clientId) continue;\n            if (!firstReturnByClient.has(f.clientId))\n                firstReturnByClient.set(f.clientId, f.scheduleAt);\n        }\n\n        const notReturned = newClientsBase.filter((c) => {\n            const firstReturn = firstReturnByClient.get(c.clientId);\n            if (!firstReturn) return true;\n            const windowEnd = addDays(c.firstAt, windowDays);\n            return firstReturn.getTime() > windowEnd.getTime();\n        });\n\n        // âœ… FIX: User NÃƒO tem companyId no schema. Filtra pela relaÃ§Ã£o companyMemberships\n        const userIds = notReturned.map((c) => c.clientId).filter(Boolean);\n\n        const users =\n            userIds.length > 0\n                ? await prisma.user.findMany({\n                      where: {\n                          id: { in: userIds },\n                          companyMemberships: {\n                              some: { companyId, isActive: true },\n                          },\n                      },\n                      select: { id: true, name: true, phone: true },\n                  })\n                : [];\n\n        const userById = new Map(users.map((u) => [u.id, u]));\n\n        riskRows = notReturned\n            .map((c) => {\n                const u = userById.get(c.clientId);\n                const windowEnd = addDays(c.firstAt, windowDays);\n\n                const daysSinceFirst = differenceInCalendarDays(now, c.firstAt);\n                const daysLeftToWindow = differenceInCalendarDays(\n                    windowEnd,\n                    now\n                );\n                const isOverdue = now.getTime() > windowEnd.getTime();\n\n                return {\n                    clientId: c.clientId,\n                    name: u?.name ?? null,\n                    phone: u?.phone ?? null,\n                    firstAt: c.firstAt,\n                    daysSinceFirst,\n                    daysLeftToWindow,\n                    isOverdue,\n                };\n            })\n            .sort((a, b) => {\n                if (a.isOverdue !== b.isOverdue) return a.isOverdue ? -1 : 1;\n                return a.daysLeftToWindow - b.daysLeftToWindow;\n            })\n            .slice(0, 20);\n    }\n\n    // ===============================\n    // RetenÃ§Ã£o por profissional\n    // ===============================\n    const firstByClientAll = (await prisma.appointment.groupBy({\n        by: ['clientId'],\n        where: {\n            companyId,\n            status: { in: DONE_ONLY },\n            ...whereAppointmentUnit(activeUnitId),\n        },\n        _min: { scheduleAt: true },\n    })) as unknown as FirstByClientRow[];\n\n    const rowsAll = firstByClientAll\n        .filter((r) => r.clientId && r._min.scheduleAt)\n        .map((r) => ({\n            clientId: r.clientId as string,\n            firstAt: r._min.scheduleAt as Date,\n        }));\n\n    const newClientsUnit: CohortItem[] = rowsAll.filter(\n        (r) => r.firstAt >= monthStart && r.firstAt <= monthEnd\n    );\n\n    const newClientsUnitIds = newClientsUnit.map((c) => c.clientId);\n\n    const firstAppointmentInMonth = newClientsUnitIds.length\n        ? await prisma.appointment.findMany({\n              where: {\n                  companyId,\n                  clientId: { in: newClientsUnitIds },\n                  status: { in: DONE_ONLY },\n                  scheduleAt: { gte: monthStart, lte: monthEnd },\n                  ...whereAppointmentUnit(activeUnitId),\n              },\n              orderBy: { scheduleAt: 'asc' },\n              distinct: ['clientId'],\n              select: {\n                  clientId: true,\n                  scheduleAt: true,\n                  professionalId: true,\n              },\n          })\n        : [];\n\n    const firstBarberByClient = new Map<string, string | null>();\n    for (const a of firstAppointmentInMonth) {\n        if (!a.clientId) continue;\n        firstBarberByClient.set(a.clientId, a.professionalId ?? null);\n    }\n\n    const newClientsByBarber = new Map<string, CohortItem[]>();\n    for (const c of newClientsUnit) {\n        const bId = firstBarberByClient.get(c.clientId);\n        if (!bId) continue;\n        const arr = newClientsByBarber.get(bId) ?? [];\n        arr.push(c);\n        newClientsByBarber.set(bId, arr);\n    }\n\n    const unitAvgKpis = await computeRetentionFromCohort({\n        companyId,\n        cohort: newClientsUnit,\n        unitId: activeUnitId,\n        professionalId: null,\n        windowDays,\n    });\n\n    const unitAvgRow = {\n        label: 'MÃ©dia da unidade',\n        cohortSize: unitAvgKpis.cohortSize,\n        retainedCount: unitAvgKpis.retainedCount,\n        lostCount: unitAvgKpis.lostCount,\n        retentionPct: unitAvgKpis.retentionPct,\n        avgReturnDays: unitAvgKpis.avgReturnDays,\n    };\n\n    let barberTableRows: BarberRetentionRow[] = [];\n\n    if (professionalIdSafe) {\n        const group = newClientsByBarber.get(professionalIdSafe) ?? [];\n        const k = await computeRetentionFromCohort({\n            companyId,\n            cohort: group,\n            unitId: activeUnitId,\n            professionalId: professionalIdSafe,\n            windowDays,\n        });\n\n        const bName =\n            professionals.find((b) => b.id === professionalIdSafe)?.name ?? 'â€”';\n\n        barberTableRows = [\n            {\n                professionalId: professionalIdSafe,\n                professionalName: bName,\n                cohortSize: k.cohortSize,\n                retainedCount: k.retainedCount,\n                lostCount: k.lostCount,\n                retentionPct: k.retentionPct,\n                avgReturnDays: k.avgReturnDays,\n            },\n        ];\n    } else {\n        const rowsPromises = professionals.map(async (b) => {\n            const group = newClientsByBarber.get(b.id) ?? [];\n            const k = await computeRetentionFromCohort({\n                companyId,\n                cohort: group,\n                unitId: activeUnitId,\n                professionalId: b.id,\n                windowDays,\n            });\n\n            return {\n                professionalId: b.id,\n                professionalName: b.name,\n                cohortSize: k.cohortSize,\n                retainedCount: k.retainedCount,\n                lostCount: k.lostCount,\n                retentionPct: k.retentionPct,\n                avgReturnDays: k.avgReturnDays,\n            } satisfies BarberRetentionRow;\n        });\n\n        barberTableRows = await Promise.all(rowsPromises);\n\n        // Ordenar: pior retenÃ§Ã£o no topo. Se nÃ£o tem \"novos clientes\", joga pro fim.\n        barberTableRows.sort((a, b) => {\n            const aHas = a.cohortSize > 0;\n            const bHas = b.cohortSize > 0;\n            if (aHas !== bHas) return aHas ? -1 : 1;\n\n            const aVal = Number.isFinite(a.retentionPct)\n                ? a.retentionPct\n                : 999999;\n            const bVal = Number.isFinite(b.retentionPct)\n                ? b.retentionPct\n                : 999999;\n            if (aVal !== bVal) return aVal - bVal;\n\n            return (b.cohortSize ?? 0) - (a.cohortSize ?? 0);\n        });\n    }\n\n    return (\n        <div className=\"space-y-6 max-w-7xl\">\n            <header className=\"space-y-3\">\n                <div className=\"flex items-center justify-between gap-3\">\n                    <h1 className=\"text-title text-content-primary\">\n                        RetenÃ§Ã£o de clientes\n                    </h1>\n\n                    <Button variant=\"outline\" asChild>\n                        <Link href=\"/admin/report\">Voltar</Link>\n                    </Button>\n                </div>\n\n                <div\n                    className={cn(\n                        'rounded-xl border border-border-primary bg-background-tertiary p-3'\n                    )}\n                >\n                    <div className=\"grid gap-3 md:grid-cols-[1fr_1fr_1fr_1fr_auto] md:items-end\">\n                        <div className=\"w-full [&_select]:h-12 [&_select]:min-h-12 [&_select]:py-2\">\n                            {ownerHasMultipleUnits ? (\n                                <UnitFilter\n                                    units={units}\n                                    value={selectedUnitValue}\n                                />\n                            ) : (\n                                <div className=\"space-y-2\">\n                                    <p className=\"text-label-small text-content-secondary\">\n                                        Unidade\n                                    </p>\n                                    <div\n                                        className={cn(\n                                            'h-12 w-full rounded-md border border-border-primary',\n                                            'bg-background-secondary px-3',\n                                            'flex items-center',\n                                            'text-content-primary text-sm'\n                                        )}\n                                        title={unitLabel}\n                                    >\n                                        <span className=\"truncate\">\n                                            {unitLabel}\n                                        </span>\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n\n                        <div className=\"w-full [&_select]:h-12 [&_select]:min-h-12 [&_select]:py-2\">\n                            <ProfessionalFilter\n                                professionals={professionals}\n                                value={professionalIdSafe}\n                            />\n                        </div>\n\n                        <div className=\"w-full [&_select]:h-12 [&_select]:min-h-12 [&_select]:py-2\">\n                            <CompareWithFilter value={compareMode} />\n                        </div>\n\n                        <div className=\"w-full [&_select]:h-12 [&_select]:min-h-12 [&_select]:py-2\">\n                            <RetentionWindowFilter value={windowDays} />\n                        </div>\n\n                        <div className=\"justify-self-end\">\n                            <MonthPicker />\n                        </div>\n                    </div>\n                </div>\n            </header>\n\n            {/* KPIs */}\n            <section className=\"grid gap-4 md:grid-cols-4\">\n                <div className=\"rounded-xl border border-border-primary bg-background-tertiary px-4 py-3\">\n                    <p className=\"text-label-small text-content-secondary\">\n                        RetenÃ§Ã£o ({windowDays} dias)\n                    </p>\n                    <p className=\"text-title text-content-primary\">\n                        {retentionRateLabel}\n                    </p>\n\n                    <p className=\"mt-2 text-[12px] text-content-primary\">\n                        De{' '}\n                        <span className=\"font-semibold tabular-nums\">\n                            {baseKpis.cohortSize}\n                        </span>{' '}\n                        clientes novos,{' '}\n                        <span className=\"font-semibold tabular-nums\">\n                            {retainedCount}\n                        </span>{' '}\n                        voltaram em atÃ©{' '}\n                        <span className=\"font-semibold tabular-nums\">\n                            {windowDays}\n                        </span>{' '}\n                        dias.\n                    </p>\n\n                    <p className=\"mt-1 text-[11px] text-content-tertiary\">\n                        {selectedProfessionalName\n                            ? `Filtro: ${selectedProfessionalName}`\n                            : 'Todos'}{' '}\n                        â€¢ MÃªs: {monthLabel}\n                    </p>\n\n                    <p className=\"mt-1 text-[11px] text-content-tertiary\">\n                        vs {compareLabel(compareMode)}:{' '}\n                        {Number.isFinite(retentionDeltaPP)\n                            ? formatSignedPP(retentionDeltaPP)\n                            : 'â€”'}\n                    </p>\n                </div>\n\n                <div className=\"rounded-xl border border-border-primary bg-background-tertiary px-4 py-3\">\n                    <p className=\"text-label-small text-content-secondary\">\n                        Voltaram ({windowDays} dias)\n                    </p>\n                    <p className=\"text-title text-content-primary\">\n                        {retainedCount}\n                    </p>\n                    <p className=\"mt-1 text-[11px] text-content-tertiary\">\n                        vs {compareLabel(compareMode)}:{' '}\n                        {formatSignedInt(retainedDelta)}\n                    </p>\n                </div>\n\n                <div className=\"rounded-xl border border-border-primary bg-background-tertiary px-4 py-3\">\n                    <p className=\"text-label-small text-content-secondary\">\n                        NÃ£o voltaram ({windowDays} dias)\n                    </p>\n                    <p className=\"text-title text-content-primary\">\n                        {lostCount}\n                    </p>\n                    <p className=\"mt-1 text-[11px] text-content-tertiary\">\n                        vs {compareLabel(compareMode)}:{' '}\n                        {formatSignedInt(lostDelta)}\n                    </p>\n                </div>\n\n                <div className=\"rounded-xl border border-border-primary bg-background-tertiary px-4 py-3\">\n                    <p className=\"text-label-small text-content-secondary\">\n                        Tempo mÃ©dio para voltar\n                    </p>\n                    <p className=\"text-title text-content-primary\">\n                        {avgReturnDaysLabel}\n                    </p>\n\n                    <p className=\"mt-1 text-[11px] text-content-tertiary\">\n                        Conta sÃ³ quem voltou\n                    </p>\n                    <p className=\"mt-1 text-[11px] text-content-tertiary\">\n                        vs {compareLabel(compareMode)}:{' '}\n                        {Number.isFinite(avgDaysDelta)\n                            ? `${avgDaysDelta > 0 ? '+' : ''}${Math.round(avgDaysDelta)} dias`\n                            : 'â€”'}\n                    </p>\n                </div>\n            </section>\n\n            {/* Curva de retorno 0..windowDays */}\n            <section className=\"rounded-xl border border-border-primary bg-background-tertiary p-4\">\n                <div className=\"flex items-start justify-between gap-3\">\n                    <div>\n                        <p className=\"text-label-large text-content-primary\">\n                            Retorno ao longo de {windowDays} dias\n                        </p>\n                        <p className=\"text-paragraph-small text-content-tertiary\">\n                            Mostra em qual dia os clientes novos voltam apÃ³s a\n                            1Âª visita (e o acumulado atÃ© aquele dia).\n                        </p>\n                    </div>\n\n                    <div className=\"text-[11px] text-content-tertiary text-right\">\n                        <div>Novos clientes: {baseKpis.cohortSize}</div>\n                        <div>Voltaram: {baseKpis.retainedCount}</div>\n                    </div>\n                </div>\n\n                {baseKpis.cohortSize === 0 ? (\n                    <div\n                        className={cn(\n                            'mt-4 h-24 w-full rounded-lg border border-border-primary',\n                            'bg-background-secondary',\n                            'flex items-center justify-center',\n                            'text-content-tertiary text-sm'\n                        )}\n                    >\n                        Sem novos clientes no mÃªs selecionado.\n                    </div>\n                ) : (\n                    <div className=\"mt-4 overflow-x-auto\">\n                        <table className=\"min-w-full text-left text-[12px]\">\n                            <thead>\n                                <tr className=\"border-b border-border-primary text-content-secondary\">\n                                    <th className=\"py-2 pr-3\">Dia</th>\n                                    <th className=\"py-2 pr-3\">Voltas</th>\n                                    <th className=\"py-2 pr-3\">Visual</th>\n                                    <th className=\"py-2 pr-3\">Acumulado</th>\n                                </tr>\n                            </thead>\n\n                            <tbody>\n                                {curveRows.map((r) => {\n                                    const w =\n                                        maxDayCount > 0\n                                            ? Math.round(\n                                                  (r.count / maxDayCount) * 100\n                                              )\n                                            : 0;\n\n                                    return (\n                                        <tr\n                                            key={r.day}\n                                            className=\"border-b border-border-primary/60 last:border-0\"\n                                        >\n                                            <td className=\"py-2 pr-3 text-content-primary font-medium tabular-nums\">\n                                                {r.day}\n                                            </td>\n\n                                            <td className=\"py-2 pr-3 text-content-primary tabular-nums\">\n                                                {r.count}\n                                            </td>\n\n                                            <td className=\"py-2 pr-3\">\n                                                <div\n                                                    className={cn(\n                                                        'h-3 w-40 rounded bg-background-secondary border border-border-primary overflow-hidden'\n                                                    )}\n                                                    title={`${r.count} voltas no dia ${r.day}`}\n                                                >\n                                                    <div\n                                                        className=\"h-full bg-emerald-500/30\"\n                                                        style={{\n                                                            width: `${w}%`,\n                                                        }}\n                                                    />\n                                                </div>\n                                            </td>\n\n                                            <td className=\"py-2 pr-3 text-content-primary tabular-nums\">\n                                                {r.cumulativeCount}{' '}\n                                                <span className=\"text-content-tertiary\">\n                                                    (\n                                                    {Math.round(\n                                                        r.cumulativePct\n                                                    )}\n                                                    %)\n                                                </span>\n                                            </td>\n                                        </tr>\n                                    );\n                                })}\n                            </tbody>\n                        </table>\n                    </div>\n                )}\n            </section>\n\n            {/* Blocos: tabelas */}\n            <section className=\"grid gap-4 lg:grid-cols-2\">\n                {/* RetenÃ§Ã£o por profissional */}\n                <div className=\"rounded-xl border border-border-primary bg-background-tertiary p-4\">\n                    <div className=\"flex items-start justify-between gap-3\">\n                        <div>\n                            <p className=\"text-label-large text-content-primary\">\n                                RetenÃ§Ã£o por profissional\n                            </p>\n                            <p className=\"text-paragraph-small text-content-tertiary\">\n                                Do menor para o maior (considerando clientes\n                                novos do mÃªs).\n                            </p>\n                        </div>\n\n                        <div className=\"text-[11px] text-content-tertiary text-right\">\n                            <div>\n                                Novos clientes na unidade:{' '}\n                                {unitAvgRow.cohortSize}\n                            </div>\n                            <div>\n                                RetenÃ§Ã£o da unidade:{' '}\n                                {formatPercent(unitAvgRow.retentionPct)}\n                            </div>\n                        </div>\n                    </div>\n\n                    {unitAvgRow.cohortSize === 0 ? (\n                        <div\n                            className={cn(\n                                'mt-4 h-48 w-full rounded-lg border border-border-primary',\n                                'bg-background-secondary',\n                                'flex items-center justify-center',\n                                'text-content-tertiary text-sm'\n                            )}\n                        >\n                            Sem clientes novos na unidade no mÃªs selecionado.\n                        </div>\n                    ) : (\n                        <div className=\"mt-4 overflow-x-auto\">\n                            <table className=\"min-w-full text-left text-[12px]\">\n                                <thead>\n                                    <tr className=\"border-b border-border-primary text-content-secondary\">\n                                        <th className=\"py-2 pr-3\">\n                                            Profissional\n                                        </th>\n                                        <th className=\"py-2 pr-3 text-right\">\n                                            Clientes novos\n                                        </th>\n                                        <th className=\"py-2 pr-3 text-right\">\n                                            Voltaram\n                                        </th>\n                                        <th className=\"py-2 pr-3 text-right\">\n                                            NÃ£o voltaram\n                                        </th>\n                                        <th className=\"py-2 pr-3 text-right\">\n                                            RetenÃ§Ã£o\n                                        </th>\n                                        <th className=\"py-2 pr-3 text-right\">\n                                            Tempo mÃ©dio\n                                        </th>\n                                    </tr>\n                                </thead>\n\n                                <tbody>\n                                    {barberTableRows.map((r) => {\n                                        const retLabel = formatPercent(\n                                            r.retentionPct\n                                        );\n                                        const avgDaysLabel = Number.isFinite(\n                                            r.avgReturnDays\n                                        )\n                                            ? `${Math.round(r.avgReturnDays)}d`\n                                            : 'â€”';\n\n                                        return (\n                                            <tr\n                                                key={r.professionalId}\n                                                className=\"border-b border-border-primary/60 last:border-0\"\n                                            >\n                                                <td className=\"py-2 pr-3 text-content-primary font-medium whitespace-nowrap\">\n                                                    {r.professionalName}\n                                                    {professionalIdSafe &&\n                                                    r.professionalId ===\n                                                        professionalIdSafe ? (\n                                                        <span className=\"ml-2 text-[11px] text-content-tertiary\">\n                                                            (selecionado)\n                                                        </span>\n                                                    ) : null}\n                                                </td>\n\n                                                <td className=\"py-2 pr-3 text-content-primary text-right tabular-nums\">\n                                                    {r.cohortSize}\n                                                </td>\n                                                <td className=\"py-2 pr-3 text-content-primary text-right tabular-nums\">\n                                                    {r.retainedCount}\n                                                </td>\n                                                <td className=\"py-2 pr-3 text-content-primary text-right tabular-nums\">\n                                                    {r.lostCount}\n                                                </td>\n                                                <td className=\"py-2 pr-3 text-content-primary text-right tabular-nums\">\n                                                    {retLabel}\n                                                </td>\n                                                <td className=\"py-2 pr-3 text-content-primary text-right tabular-nums\">\n                                                    {avgDaysLabel}\n                                                </td>\n                                            </tr>\n                                        );\n                                    })}\n\n                                    <tr className=\"border-t border-border-primary\">\n                                        <td className=\"py-2 pr-3 text-content-primary font-medium\">\n                                            {unitAvgRow.label}\n                                        </td>\n                                        <td className=\"py-2 pr-3 text-content-primary text-right tabular-nums\">\n                                            {unitAvgRow.cohortSize}\n                                        </td>\n                                        <td className=\"py-2 pr-3 text-content-primary text-right tabular-nums\">\n                                            {unitAvgRow.retainedCount}\n                                        </td>\n                                        <td className=\"py-2 pr-3 text-content-primary text-right tabular-nums\">\n                                            {unitAvgRow.lostCount}\n                                        </td>\n                                        <td className=\"py-2 pr-3 text-content-primary text-right tabular-nums\">\n                                            {formatPercent(\n                                                unitAvgRow.retentionPct\n                                            )}\n                                        </td>\n                                        <td className=\"py-2 pr-3 text-content-primary text-right tabular-nums\">\n                                            {Number.isFinite(\n                                                unitAvgRow.avgReturnDays\n                                            )\n                                                ? `${Math.round(unitAvgRow.avgReturnDays)}d`\n                                                : 'â€”'}\n                                        </td>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n                    )}\n                </div>\n\n                {/* Clientes em risco */}\n                <div className=\"rounded-xl border border-border-primary bg-background-tertiary p-4\">\n                    <p className=\"text-label-large text-content-primary\">\n                        Clientes em risco\n                    </p>\n                    <p className=\"text-paragraph-small text-content-tertiary\">\n                        Clientes novos do mÃªs que ainda nÃ£o voltaram em atÃ©{' '}\n                        {windowDays} dias.\n                    </p>\n\n                    {baseKpis.cohortSize === 0 ? (\n                        <div\n                            className={cn(\n                                'mt-4 h-48 w-full rounded-lg border border-border-primary',\n                                'bg-background-secondary',\n                                'flex items-center justify-center',\n                                'text-content-tertiary text-sm'\n                            )}\n                        >\n                            Sem clientes novos no mÃªs selecionado.\n                        </div>\n                    ) : riskRows.length === 0 ? (\n                        <div\n                            className={cn(\n                                'mt-4 h-48 w-full rounded-lg border border-border-primary',\n                                'bg-background-secondary',\n                                'flex items-center justify-center',\n                                'text-content-tertiary text-sm'\n                            )}\n                        >\n                            ðŸŽ‰ NinguÃ©m em risco (todos voltaram em atÃ©{' '}\n                            {windowDays} dias).\n                        </div>\n                    ) : (\n                        <div className=\"mt-4 overflow-x-auto\">\n                            <table className=\"min-w-full text-left text-[12px]\">\n                                <thead>\n                                    <tr className=\"border-b border-border-primary text-content-secondary\">\n                                        <th className=\"py-2 pr-3\">Cliente</th>\n                                        <th className=\"py-2 pr-3\">Telefone</th>\n                                        <th className=\"py-2 pr-3\">1Âª visita</th>\n                                        <th className=\"py-2 pr-3\">\n                                            Dias sem voltar\n                                        </th>\n                                        <th className=\"py-2 pr-3\">Status</th>\n                                    </tr>\n                                </thead>\n\n                                <tbody>\n                                    {riskRows.map((r) => (\n                                        <tr\n                                            key={r.clientId}\n                                            className=\"border-b border-border-primary/60 last:border-0\"\n                                        >\n                                            <td className=\"py-2 pr-3 text-content-primary font-medium\">\n                                                {r.name ?? 'Sem nome'}\n                                            </td>\n\n                                            <td className=\"py-2 pr-3 text-content-primary tabular-nums\">\n                                                {r.phone ?? 'â€”'}\n                                            </td>\n\n                                            <td className=\"py-2 pr-3 text-content-primary\">\n                                                {format(\n                                                    r.firstAt,\n                                                    'dd/MM/yyyy',\n                                                    { locale: ptBR }\n                                                )}\n                                            </td>\n\n                                            <td className=\"py-2 pr-3 text-content-primary tabular-nums\">\n                                                {Math.max(0, r.daysSinceFirst)}d\n                                            </td>\n\n                                            <td className=\"py-2 pr-3\">\n                                                {r.isOverdue ? (\n                                                    <span className=\"text-[11px] rounded-full px-2 py-1 border border-rose-500/30 bg-rose-500/10 text-rose-200\">\n                                                        Passou de {windowDays}{' '}\n                                                        dias\n                                                    </span>\n                                                ) : (\n                                                    <span className=\"text-[11px] rounded-full px-2 py-1 border border-amber-500/30 bg-amber-500/10 text-amber-200\">\n                                                        Faltam{' '}\n                                                        {Math.max(\n                                                            0,\n                                                            r.daysLeftToWindow\n                                                        )}{' '}\n                                                        dias\n                                                    </span>\n                                                )}\n                                            </td>\n                                        </tr>\n                                    ))}\n                                </tbody>\n                            </table>\n                        </div>\n                    )}\n                </div>\n            </section>\n        </div>\n    );\n}\n","export * from './professional-filter';\n","export * from './retention-window-filter';\n"],"names":[],"mappings":"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","ignoreList":[0]}