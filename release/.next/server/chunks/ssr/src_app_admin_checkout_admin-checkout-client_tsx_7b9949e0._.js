module.exports=[798917,a=>{"use strict";var b=a.i(584944),c=a.i(107439),d=a.i(259849),e=a.i(156916);a.i(217018);var f=a.i(7329),g=a.i(699570),h=a.i(368114);function i({status:a}){let c={PENDING:{label:"Pendente",toneClass:"bg-amber-500/15 text-amber-700 border-amber-500/30"},PENDING_CHECKIN:{label:"Aguard. check-in",toneClass:"bg-amber-500/15 text-amber-700 border-amber-500/30"},COMPLETED:{label:"Pago",toneClass:"bg-green-500/15 text-green-600 border-green-500/30"},CANCELED:{label:"Cancelado",toneClass:"bg-red-500/15 text-red-600 border-red-500/30"}}[a];return(0,b.jsx)("span",{className:(0,h.cn)("inline-flex items-center rounded-md border px-2 py-0.5 text-xs",c.toneClass),children:c.label})}function j({title:a,hint:c}){return(0,b.jsxs)("div",{className:"rounded-xl border border-border-primary bg-background-tertiary px-4 py-6",children:[(0,b.jsx)("p",{className:"text-paragraph-small text-content-secondary text-center",children:a}),c?(0,b.jsx)("p",{className:"mt-2 text-paragraph-small text-content-tertiary text-center",children:c}):null]})}function k({monthLabel:a,totalCountLabel:c,groups:d}){return(0,b.jsxs)("section",{className:"space-y-3",children:[(0,b.jsx)("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-subtitle text-content-primary",children:"Pedidos do mês"}),(0,b.jsxs)("p",{className:"text-paragraph-small text-content-secondary",children:["Lista de todos os pedidos de serviços e produtos registrados neste mês.",(0,b.jsx)("br",{}),"Mês selecionado:"," ",(0,b.jsx)("span",{className:"font-medium",children:a})]}),(0,b.jsxs)("p",{className:"text-paragraph-small text-content-secondary mt-1",children:["Total:"," ",(0,b.jsx)("span",{className:"font-medium",children:c})]})]})}),0===d.length?(0,b.jsx)(j,{title:"Nenhum pedido registrado neste mês ainda."}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"space-y-3",children:d.map(a=>(0,b.jsxs)("div",{className:"rounded-xl border border-border-primary bg-background-tertiary px-4 py-3 space-y-3",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("p",{className:"text-paragraph-small text-content-primary truncate",children:["Cliente:"," ",(0,b.jsx)("span",{className:"font-medium",children:a.clientLabel})]}),(0,b.jsxs)("p",{className:"text-paragraph-small text-content-secondary",children:["Última movimentação em"," ",a.latestLabel]}),(0,b.jsxs)("p",{className:"text-paragraph-small text-content-secondary mt-1",children:[(0,b.jsxs)("span",{children:["Serviços:"," ",(0,b.jsx)("span",{className:"font-medium",children:a.servicesLabel})]}),(0,b.jsx)("span",{className:"mx-2",children:"•"}),(0,b.jsxs)("span",{children:["Produtos:"," ",(0,b.jsx)("span",{className:"font-medium",children:a.productsLabel})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,b.jsxs)("span",{className:"text-paragraph-small font-semibold text-content-primary",children:["Total no mês: ",a.totalLabel]}),(0,b.jsx)(i,{status:"COMPLETED"})]})]}),(0,b.jsxs)("div",{className:"pt-2 border-t border-border-primary space-y-2",children:[(0,b.jsxs)("p",{className:"text-label-small text-content-secondary",children:["Pedidos (",a.orders.length,")"]}),(0,b.jsx)("div",{className:"space-y-2",children:a.orders.map(a=>{let c=a.items.filter(a=>"service"===a.kind),d=a.items.filter(a=>"product"===a.kind);return(0,b.jsxs)("details",{className:"rounded-lg border border-border-primary bg-background-secondary px-3 py-2",children:[(0,b.jsx)("summary",{className:"cursor-pointer list-none",children:(0,b.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("p",{className:"text-paragraph-small text-content-primary truncate",children:["Pedido #",a.id.slice(0,8)]}),(0,b.jsxs)("p",{className:"text-paragraph-small text-content-secondary",children:["Criado em"," ",a.createdAtLabel]}),a.appointmentAtLabel?(0,b.jsxs)("p",{className:"text-paragraph-small text-content-secondary",children:["Atendimento em"," ",a.appointmentAtLabel]}):null,(0,b.jsxs)("p",{className:"text-paragraph-small text-content-secondary",children:["Profissional:"," ",a.professionalName]})]}),(0,b.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,b.jsx)("span",{className:"text-paragraph-small font-semibold text-content-primary",children:a.totalLabel}),(0,b.jsx)(i,{status:"COMPLETED"})]})]})}),(0,b.jsxs)("div",{className:"mt-3 space-y-3",children:[c.length>0?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-label-small text-content-secondary",children:"Serviços"}),(0,b.jsx)("div",{className:"overflow-x-auto rounded-lg border border-border-primary",children:(0,b.jsxs)("table",{className:"min-w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-border-primary bg-muted/40 text-left text-label-small text-content-secondary",children:[(0,b.jsx)("th",{className:"px-3 py-2",children:"Item"}),(0,b.jsx)("th",{className:"px-3 py-2 text-center",children:"Qtd"}),(0,b.jsx)("th",{className:"px-3 py-2 text-right",children:"Unit."}),(0,b.jsx)("th",{className:"px-3 py-2 text-right",children:"Total"})]})}),(0,b.jsxs)("tbody",{children:[c.map(a=>(0,b.jsxs)("tr",{className:"border-t border-border-primary text-paragraph-small text-content-primary",children:[(0,b.jsx)("td",{className:"px-3 py-2",children:a.name}),(0,b.jsx)("td",{className:"px-3 py-2 text-center",children:a.qty}),(0,b.jsx)("td",{className:"px-3 py-2 text-right",children:a.unitLabel}),(0,b.jsx)("td",{className:"px-3 py-2 text-right",children:a.totalLabel})]},a.id)),(0,b.jsxs)("tr",{className:"border-t border-border-primary",children:[(0,b.jsx)("td",{className:"px-3 py-2 text-right text-content-secondary",colSpan:3,children:"Subtotal serviços"}),(0,b.jsx)("td",{className:"px-3 py-2 text-right font-semibold text-content-primary",children:a.servicesSubtotalLabel})]})]})]})})]}):null,d.length>0?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-label-small text-content-secondary",children:"Produtos"}),(0,b.jsx)("div",{className:"overflow-x-auto rounded-lg border border-border-primary",children:(0,b.jsxs)("table",{className:"min-w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-border-primary bg-muted/40 text-left text-label-small text-content-secondary",children:[(0,b.jsx)("th",{className:"px-3 py-2",children:"Item"}),(0,b.jsx)("th",{className:"px-3 py-2 text-center",children:"Qtd"}),(0,b.jsx)("th",{className:"px-3 py-2 text-right",children:"Unit."}),(0,b.jsx)("th",{className:"px-3 py-2 text-right",children:"Total"})]})}),(0,b.jsxs)("tbody",{children:[d.map(a=>(0,b.jsxs)("tr",{className:"border-t border-border-primary text-paragraph-small text-content-primary",children:[(0,b.jsx)("td",{className:"px-3 py-2",children:a.name}),(0,b.jsx)("td",{className:"px-3 py-2 text-center",children:a.qty}),(0,b.jsx)("td",{className:"px-3 py-2 text-right",children:a.unitLabel}),(0,b.jsx)("td",{className:"px-3 py-2 text-right",children:a.totalLabel})]},a.id)),(0,b.jsxs)("tr",{className:"border-t border-border-primary",children:[(0,b.jsx)("td",{className:"px-3 py-2 text-right text-content-secondary",colSpan:3,children:"Subtotal produtos"}),(0,b.jsx)("td",{className:"px-3 py-2 text-right font-semibold text-content-primary",children:a.productsSubtotalLabel})]})]})]})})]}):null]})]},a.id)})})]})]},a.clientKey))}),(0,b.jsx)("div",{className:"flex flex-col gap-2 items-center",children:(0,b.jsx)("div",{className:"rounded-xl border border-border-primary bg-background-tertiary px-4 py-3",children:(0,b.jsx)("p",{className:"text-paragraph-small text-content-secondary",children:"Paginação será conectada quando integrarmos os dados."})})})]})]})}function l(a){return String(a??"").slice(0,8)}function m(a,b){let c=Number(a);return Number.isFinite(c)?Math.max(1,Math.trunc(c)):b}function n({canSeeAllUnits:a,monthLabel:n,openAccounts:o,monthGroups:p}){let q=(0,d.useRouter)(),r=(0,d.useSearchParams)(),[s,t]=c.useState(null),[u,v]=c.useState(()=>new Set),[w,x]=c.useState(null),[y,z]=c.useState([]),[A,B]=c.useState(!1),[C,D]=c.useState([]),[E,F]=c.useState(!1),[G,H]=c.useState({}),[I,J]=c.useState({}),[K,L]=c.useState(null),[M,N]=c.useState(()=>new Set),[O,P]=c.useState(()=>new Set),[Q,R]=c.useState({}),[S,T]=c.useState({}),U=o.length,V=c.useCallback(async a=>{let b=await fetch(`/api/admin/checkout/orders/${encodeURIComponent(a)}/complete`,{method:"PATCH"}),c=await b.json().catch(()=>null);if(!b.ok||!c||!c.ok)throw Error(c&&!c.ok?c.error:"Falha ao concluir checkout.");return c.data},[]),W=c.useCallback(async a=>{let b=await fetch(`/api/admin/checkout/orders/${encodeURIComponent(a)}/cancel`,{method:"PATCH"}),c=await b.json().catch(()=>null);if(!b.ok||!c||!c.ok)throw Error(c&&!c.ok?c.error:"Falha ao cancelar pedido.");return c.data},[]),X=c.useCallback(async(a,b)=>{let c=await fetch(`/api/admin/checkout/accounts/${encodeURIComponent(a)}/cancel`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderIds:b})}),d=await c.json().catch(()=>null);if(!c.ok||!d||!d.ok)throw Error(d&&!d.ok?d.error:"Falha ao cancelar conta.");return d.data},[]),Y=c.useCallback(async(a,b,c)=>{let d=await fetch(`/api/admin/checkout/accounts/${encodeURIComponent(a)}/add-product`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:b,quantity:c})}),e=await d.json().catch(()=>null);if(!d.ok||!e||!e.ok)throw Error(e&&!e.ok?e.error:"Falha ao adicionar produto.");return e.data},[]),Z=c.useCallback(async(a,b)=>{let c=await fetch(`/api/admin/checkout/orders/${encodeURIComponent(a)}/remove-product-item`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemId:b})}),d=await c.json().catch(()=>null);if(!c.ok||!d||!d.ok)throw Error(d&&!d.ok?d.error:"Falha ao remover produto.");return d.data},[]),$=c.useCallback(async(a,b,c)=>{let d=await fetch(`/api/admin/checkout/orders/${encodeURIComponent(a)}/assign-product-item-professional`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemId:b,professionalId:c})}),e=await d.json().catch(()=>null);if(!d.ok||!e||!e.ok)throw Error(e&&!e.ok?e.error:"Falha ao atribuir profissional.");return e.data},[]),_=c.useCallback(a=>(v(b=>{let c=new Set(b);return c.add(a),c}),()=>{v(b=>{let c=new Set(b);return c.delete(a),c})}),[]),aa=c.useCallback(a=>(N(b=>{let c=new Set(b);return c.add(a),c}),()=>{N(b=>{let c=new Set(b);return c.delete(a),c})}),[]),ab=c.useCallback(a=>(P(b=>{let c=new Set(b);return c.add(a),c}),()=>{P(b=>{let c=new Set(b);return c.delete(a),c})}),[]),ac=c.useCallback(async a=>{if(!a||s||w||K||!window.confirm(`Cancelar o pedido #${l(a)}?

Isso cancelar\xe1 o pedido inteiro.`))return;let b=_(a);try{e.toast.message(`Cancelando pedido #${l(a)}…`),await W(a),e.toast.success("Pedido cancelado."),q.refresh()}catch(a){e.toast.error(a?.message??"Erro ao cancelar pedido.")}finally{b()}},[K,W,w,s,q,_]),ad=c.useCallback(async(a,b)=>{if(!a||!b?.itemId||s||w||K||M.has(b.itemId)||!window.confirm(`Remover este produto do pedido #${l(a)}?

• ${b.qty}x ${b.name}
• Total do item: ${b.totalLabel}`))return;let c=aa(b.itemId),d=_(a);try{e.toast.message(`Removendo produto de #${l(a)}…`),await Z(a,b.itemId),e.toast.success("Produto removido."),q.refresh()}catch(a){e.toast.error(a?.message??"Erro ao remover produto.")}finally{d(),c()}},[K,w,s,Z,M,q,_,aa]),ae=c.useCallback(async(a,b,c)=>{if(!a||!b?.itemId||!c||s||w||K||O.has(b.itemId))return;let d=ab(b.itemId),f=_(a);try{e.toast.message(`Salvando profissional do item…`),await $(a,b.itemId,c),e.toast.success("Profissional atribuído."),q.refresh()}catch(a){e.toast.error(a?.message??"Erro ao atribuir profissional.")}finally{f(),d()}},[K,$,O,w,s,q,ab,_]);c.useCallback(async a=>{let b=a?.clientId;if(!b)return;let c=String(S[b]??"").trim();if(!c)return void e.toast.message("Selecione um profissional para aplicar.");if(s||w||K)return;let d=[];for(let b of a.productOrders??[])for(let a of Array.isArray(b.items)?b.items:[])a?.itemId&&(a.professionalId||d.push({orderId:b.id,item:a}));if(0===d.length)return void e.toast.message("Todos os itens já têm profissional.");if(window.confirm(`Aplicar o profissional selecionado em ${d.length} item(ns) sem profissional?`))try{for(let a=0;a<d.length;a++){let{orderId:b,item:f}=d[a],g=ab(f.itemId),h=_(b);try{e.toast.message(`Aplicando ${a+1}/${d.length}…`),await $(b,f.itemId,c)}finally{h(),g()}}e.toast.success("Profissional aplicado nos itens pendentes."),q.refresh()}catch(a){e.toast.error(a?.message??"Erro ao aplicar profissional.")}},[K,$,S,w,s,q,ab,_]);let af=c.useCallback(async a=>{if(!a?.clientId||s||w||K)return;let b=[...a.serviceOrders.map(a=>a.id),...a.productOrders.map(a=>a.id)].filter(Boolean);if(0===b.length)return void e.toast.message("Nada para cancelar nesta conta.");if(window.confirm(`Cancelar a conta do cliente "${a.clientLabel}"?

Isso cancelar\xe1 ${b.length} pedido(s) pendente(s).`)){x(a.clientId);try{e.toast.message(`Cancelando conta…`);let c=await X(a.clientId,b);0===c.canceledCount?e.toast.message("Nenhum pedido foi cancelado."):e.toast.success(`Conta cancelada: ${c.canceledCount} pedido(s).`),q.refresh()}catch(a){e.toast.error(a?.message??"Erro ao cancelar conta.")}finally{x(null)}}},[K,X,w,s,q]),ag=c.useCallback(async()=>{B(!0);try{let a=r?.get("unit"),b=new URLSearchParams;a&&"all"!==a&&b.set("unit",a);let c=`/api/admin/checkout/products${b.toString()?`?${b.toString()}`:""}`,d=await fetch(c,{method:"GET"}),e=await d.json().catch(()=>null);if(!d.ok||!e||!e.ok){let a=e&&!e.ok?e.error:"Falha ao carregar produtos.";throw Error(a)}z(e.data.products??[])}catch(a){e.toast.error(a?.message??"Erro ao carregar produtos."),z([])}finally{B(!1)}},[r]),ah=c.useCallback(async()=>{F(!0);try{let a=r?.get("unit"),b=new URLSearchParams;a&&"all"!==a&&b.set("unit",a);let c=`/api/admin/checkout/professionals${b.toString()?`?${b.toString()}`:""}`,d=await fetch(c,{method:"GET"}),e=await d.json().catch(()=>null);if(!d.ok||!e||!e.ok){let a=e&&!e.ok?e.error:"Falha ao carregar profissionais.";throw Error(a)}D(e.data.professionals??[])}catch(a){e.toast.error(a?.message??"Erro ao carregar profissionais."),D([])}finally{F(!1)}},[r]);c.useEffect(()=>{ag(),ah()},[ag,ah]);let ai=c.useCallback(async a=>{let b=a?.clientId;if(!b||s||w||K)return;let c=G[b]??"",d=I[b]??1;if(!c)return void e.toast.message("Selecione um produto.");let f=m(d,1),g=y.find(a=>a.id===c);if(g&&g.stockQuantity<f)return void e.toast.error(`Estoque insuficiente: dispon\xedvel ${g.stockQuantity}, solicitado ${f}.`);L(b);try{e.toast.message("Adicionando produto…");let a=await Y(b,c,f);e.toast.success(`Produto adicionado${a.orderWasCreated?" (novo pedido criado)":""}.`),H(a=>{let c={...a};return c[b]="",c}),J(a=>{let c={...a};return c[b]=1,c}),ag(),q.refresh()}catch(a){e.toast.error(a?.message??"Erro ao adicionar produto.")}finally{L(null)}},[Y,K,w,s,y,I,q,G,ag]),aj=c.useCallback(async a=>{if(s||w||K)return;if(a.hasProducts){let b=(a.productOrders??[]).flatMap(a=>Array.isArray(a.items)?a.items:[]).filter(Boolean);if(b.length>0){let a=b.filter(a=>{let b=String(a.professionalId??"").trim(),c=String(Q[a.itemId]??"").trim();return!b&&!c});if(a.length>0)return void e.toast.error(`Faltou profissional em ${a.length} item(ns) de produto. Selecione o profissional em cada item antes de concluir.`)}}let b=[...a.serviceOrders.map(a=>a.id),...a.productOrders.map(a=>a.id)].filter(Boolean);if(0===b.length)return void e.toast.message("Nada para pagar nesta conta.");t(a.clientId);let c=0,d=[];try{for(let a=0;a<b.length;a++){let f=b[a],g=_(f);try{e.toast.message(`Concluindo ${a+1}/${b.length}: #${l(f)}…`),await V(f),c++}catch(a){d.push({id:f,error:a?.message??"Erro ao concluir."})}finally{g()}}0===d.length?e.toast.success("Conta marcada como paga."):0===c?e.toast.error(`Nenhum pedido foi conclu\xeddo. Primeiro erro: #${l(d[0].id)} (${d[0].error})`):(e.toast.message(`Finalizado: ${c} pago(s), ${d.length} com erro.`),e.toast.error(`Erro em #${l(d[0].id)}: ${d[0].error}`)),q.refresh()}catch(a){e.toast.error(a?.message??"Erro ao concluir checkout.")}finally{t(null)}},[K,w,V,s,q,_]);return(0,b.jsxs)("div",{className:"space-y-5 max-w-7xl",children:[(0,b.jsxs)("header",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-title text-content-primary",children:"Checkout"}),(0,b.jsx)("p",{className:"text-paragraph-medium text-content-secondary",children:"Finalize os pagamentos de atendimentos e pedidos de produtos."}),(0,b.jsxs)("p",{className:"text-paragraph-small text-content-tertiary mt-1",children:["Escopo de unidades:"," ",a?"todas as unidades":"unidade atual"]})]}),(0,b.jsx)(f.MonthPicker,{})]}),(0,b.jsxs)("section",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex items-center justify-between gap-3",children:(0,b.jsxs)("h2",{className:"text-subtitle text-content-primary",children:["Contas em aberto"," ",(0,b.jsxs)("span",{className:"text-content-secondary font-normal",children:["(",U,")"]})]})}),0===o.length?(0,b.jsx)(j,{title:"Não há contas aguardando pagamento no momento."}):(0,b.jsx)("div",{className:"space-y-3",children:o.map(a=>{let c=s===a.clientId,d=w===a.clientId,e=K===a.clientId,f=[...a.serviceOrders.map(a=>a.id),...a.productOrders.map(a=>a.id)].filter(Boolean).some(a=>u.has(a)),j=G[a.clientId]??"",k=I[a.clientId]??1,n=!!s||!!w||!!K,o=(a.productOrders??[]).flatMap(a=>Array.isArray(a.items)?a.items:[]).filter(Boolean),p=a.hasProducts&&o.length>0?o.filter(a=>{let b=String(a.professionalId??"").trim(),c=String(Q[a.itemId]??"").trim();return!b&&!c}).length:0;return S[a.clientId],(0,b.jsxs)("div",{className:"rounded-xl border border-border-primary bg-background-tertiary px-4 py-3 space-y-3",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("p",{className:"text-paragraph-small text-content-primary truncate",children:["Cliente:"," ",(0,b.jsx)("span",{className:"font-medium",children:a.clientLabel})]}),(0,b.jsxs)("p",{className:"text-paragraph-small text-content-secondary",children:["Última movimentação em"," ",a.latestLabel]}),(0,b.jsxs)("p",{className:"text-paragraph-small text-content-secondary mt-1",children:[(0,b.jsxs)("span",{children:["Serviços:"," ",(0,b.jsx)("span",{className:"font-medium",children:a.totalServicesLabel})]}),(0,b.jsx)("span",{className:"mx-2",children:"•"}),(0,b.jsxs)("span",{children:["Produtos:"," ",(0,b.jsx)("span",{className:"font-medium",children:a.totalProductsLabel})]})]}),a.hasProducts&&o.length>0?(0,b.jsxs)("p",{className:"text-paragraph-small text-content-tertiary mt-1",children:["Itens de produto sem profissional:"," ",(0,b.jsx)("span",{className:"font-medium",children:p})]}):null]}),(0,b.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,b.jsxs)("span",{className:"text-paragraph-small font-semibold text-content-primary",children:["Total a pagar:"," ",a.totalLabel]}),(0,b.jsx)(i,{status:"PENDING"})]})]}),a.serviceOrders.length>0?(0,b.jsxs)("div",{className:"space-y-2 pt-2 border-t border-border-primary",children:[(0,b.jsx)("p",{className:"text-label-small text-content-secondary",children:"Serviços pendentes"}),(0,b.jsx)("div",{className:"space-y-2",children:a.serviceOrders.map(a=>{let c=u.has(a.id);return(0,b.jsx)("div",{className:(0,h.cn)("rounded-lg border border-border-primary bg-background-secondary px-3 py-2",c&&"opacity-70"),children:(0,b.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("p",{className:"text-paragraph-small text-content-primary truncate",children:["Atendimento #",l(a.id)]}),a.appointmentAtLabel?(0,b.jsxs)("p",{className:"text-paragraph-small text-content-secondary",children:["Atendimento em"," ",a.appointmentAtLabel]}):null,(0,b.jsxs)("p",{className:"text-paragraph-small text-content-secondary",children:["Profissional:"," ",a.professionalName]}),(0,b.jsxs)("p",{className:"text-paragraph-small text-content-secondary",children:["Serviços:"," ",a.itemsLabel]})]}),(0,b.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,b.jsx)("span",{className:"text-paragraph-small font-semibold text-content-primary",children:a.totalLabel}),(0,b.jsx)(i,{status:a.status})]})]})},a.id)})})]}):null,a.productOrders.length>0?(0,b.jsxs)("div",{className:"space-y-2 pt-2 border-t border-border-primary",children:[(0,b.jsx)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-label-small text-content-secondary",children:"Produtos na conta"}),(0,b.jsx)("p",{className:"text-xs text-content-tertiary",children:"Remova item por item e atribua o profissional da venda."})]})}),(0,b.jsx)("div",{className:"space-y-2",children:a.productOrders.map(c=>{let d,e=u.has(c.id),f=c.items&&Array.isArray(c.items)?c.items:[],j=0===f.length&&(d=String(c.itemsLabel??"").trim())&&"—"!==d?d.split(",").map(a=>a.trim()).filter(Boolean):[];return(0,b.jsxs)("div",{className:(0,h.cn)("rounded-lg border border-border-primary bg-background-secondary px-3 py-2",e&&"opacity-70"),children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("p",{className:"text-paragraph-small text-content-primary truncate",children:["Pedido #",l(c.id)]}),(0,b.jsxs)("p",{className:"text-paragraph-small text-content-secondary",children:["Criado em"," ",c.createdAtLabel]})]}),(0,b.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,b.jsx)("span",{className:"text-paragraph-small font-semibold text-content-primary",children:c.totalLabel}),(0,b.jsx)(i,{status:c.status})]})]}),f.length>0?(0,b.jsx)("div",{className:"mt-3 space-y-2",children:f.map(d=>{let f=M.has(d.itemId),i=O.has(d.itemId),j=e||f||i||!!s||!!w||!!K,k=Q[d.itemId]??String(d.professionalId??""),l=j||E,m=!!String(d.professionalId??"").trim();return(0,b.jsxs)("div",{className:(0,h.cn)("rounded-lg border border-border-primary bg-background-tertiary px-3 py-2",(f||i)&&"opacity-70"),children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("p",{className:"text-paragraph-small text-content-primary truncate",children:[d.qty,"x"," ",d.name]}),(0,b.jsxs)("p",{className:"text-paragraph-small text-content-secondary",children:["Total do item:"," ",(0,b.jsx)("span",{className:"font-medium text-content-primary",children:d.totalLabel})]}),d.professionalName?(0,b.jsxs)("p",{className:"text-xs text-content-tertiary mt-1",children:["Profissional atual:"," ",(0,b.jsx)("span",{className:"font-medium text-content-secondary",children:d.professionalName})]}):null]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:[a.hasProducts?(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("select",{value:k,onChange:a=>{let b=a.target.value;R(a=>({...a,[d.itemId]:b}));let e=String(b??"").trim();e&&ae(c.id,d,e)},className:(0,h.cn)("h-9 rounded-md border border-border-primary bg-background-secondary px-2 text-sm text-content-primary",!m&&"border-amber-500/40"),disabled:l,title:0===C.length?"Sem profissionais disponíveis":void 0,children:[(0,b.jsx)("option",{value:"",children:E?"Carregando...":0===C.length?"Sem profissionais":"Selecione o profissional"}),C.map(a=>(0,b.jsxs)("option",{value:a.id,disabled:!a.isActive,children:[a.name,a.isActive?"":" (inativo)"]},a.id))]})}):null,(0,b.jsx)(g.Button,{type:"button",variant:"outline",size:"sm",className:"text-red-500 border-red-500/40 hover:bg-red-500/5",onClick:()=>ad(c.id,d),disabled:j,title:j?"Processando...":"Remover este produto",children:f?"Removendo...":"Remover"})]})]}),a.hasProducts&&!m?(0,b.jsx)("p",{className:"mt-2 text-xs text-amber-700",children:"Selecione o profissional para liberar o checkout desta conta."}):null]},d.itemId)})}):j.length>0?(0,b.jsxs)("div",{className:"mt-2",children:[(0,b.jsx)("p",{className:"text-paragraph-small text-content-secondary",children:"Itens:"}),(0,b.jsx)("ul",{className:"pl-4 list-disc space-y-0.5",children:j.map((a,d)=>(0,b.jsx)("li",{className:"text-paragraph-small text-content-secondary",children:a},`${c.id}:${d}`))}),(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsx)(g.Button,{type:"button",variant:"outline",size:"sm",className:"text-red-500 border-red-500/40 hover:bg-red-500/5",onClick:()=>ac(c.id),disabled:e||!!s||!!w||!!K,children:e?"Processando...":"Cancelar pedido"})}),a.hasProducts?(0,b.jsxs)("p",{className:"mt-2 text-xs text-content-tertiary",children:["Para atribuir profissional por produto, o backend precisa enviar"," ",(0,b.jsx)("span",{className:"font-medium",children:"items[]"})," ","com"," ",(0,b.jsx)("span",{className:"font-medium",children:"itemId"}),"."]}):null]}):(0,b.jsxs)("p",{className:"mt-2 text-paragraph-small text-content-secondary",children:["Itens:"," ","—"]})]},c.id)})})]}):null,(0,b.jsxs)("div",{className:"pt-2 border-t border-border-primary space-y-2",children:[(0,b.jsx)("div",{className:"flex items-center justify-between gap-2",children:(0,b.jsx)("p",{className:"text-label-small text-content-secondary",children:"Adicionar produto na conta"})}),(0,b.jsxs)("div",{className:"flex flex-wrap items-end gap-2",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("label",{className:"text-xs text-content-secondary",children:"Produto"}),(0,b.jsxs)("select",{value:j,onChange:b=>H(c=>({...c,[a.clientId]:b.target.value})),className:"h-9 min-w-60 rounded-md border border-border-primary bg-background-secondary px-2 text-sm text-content-primary",disabled:n||A||0===y.length,children:[(0,b.jsx)("option",{value:"",disabled:!0,children:A?"Carregando...":0===y.length?"Sem produtos disponíveis":"Selecione o produto"}),y.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," •"," ",a.priceLabel," • estoque:"," ",a.stockQuantity]},a.id))]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("label",{className:"text-xs text-content-secondary",children:"Qtd"}),(0,b.jsx)("input",{type:"number",min:1,value:k,onChange:b=>J(c=>({...c,[a.clientId]:m(b.target.value,1)})),className:"h-9 w-24 rounded-md border border-border-primary bg-background-secondary px-2 text-sm text-content-primary",disabled:n})]}),(0,b.jsx)(g.Button,{type:"button",variant:"edit2",size:"sm",onClick:()=>ai(a),disabled:n||A||!j||0===y.length,title:e?"Adicionando...":void 0,children:e?"Adicionando...":"Adicionar produto"}),0!==y.length||A?(0,b.jsx)("p",{className:"text-xs text-content-secondary w-full",children:"O preço é calculado no checkout e fica congelado no item."}):(0,b.jsx)("p",{className:"text-xs text-content-tertiary w-full",children:"Nenhum produto disponível para esta unidade/filtro."})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3 pt-2 border-t border-border-primary",children:[(0,b.jsx)("div",{className:"flex-1 min-w-0",children:a.hasProducts?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-label-small text-content-secondary mb-1",children:"Profissional responsável pela venda dos produtos"}),(0,b.jsx)("p",{className:"text-paragraph-small text-content-secondary",children:"Atribua o profissional em cada item de produto para calcular faturamento e comissão."})]}):(0,b.jsx)("p",{className:"text-paragraph-small text-content-secondary",children:"Esta conta tem apenas serviços. Você pode finalizar direto."})}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[(0,b.jsx)(g.Button,{type:"button",variant:"destructive",size:"sm",onClick:()=>af(a),disabled:c||f||d||e||a.hasProducts&&p>0,title:c||f||d||e?"Processando...":"Cancela todos os pedidos pendentes da conta",children:d?"Cancelando...":"Cancelar conta"}),(0,b.jsx)(g.Button,{type:"button",variant:"edit2",size:"sm",onClick:()=>aj(a),disabled:c||f||d||e||a.hasProducts&&p>0,title:a.hasProducts&&p>0?`Faltam ${p} item(ns) de produto sem profissional.`:c||f||d||e?"Concluindo checkout...":void 0,children:c||f?"Concluindo...":"Marcar tudo como pago"})]})]})]},a.clientId)})}),null]}),(0,b.jsx)(k,{monthLabel:n,totalCountLabel:`${p.reduce((a,b)=>a+b.orders.length,0)} pedidos`,groups:p})]})}a.s(["default",()=>n])}];

//# sourceMappingURL=src_app_admin_checkout_admin-checkout-client_tsx_7b9949e0._.js.map