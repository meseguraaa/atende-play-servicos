{"version":3,"sources":["turbopack:///[project]/src/lib/admin-permissions.ts","turbopack:///[project]/src/app/admin/appointments/admin-appointments-client.tsx/__nextjs-internal-proxy.mjs","turbopack:///[project]/src/app/admin/appointments/page.tsx"],"sourcesContent":["// src/lib/admin-permissions.ts\nimport { redirect } from 'next/navigation';\nimport { NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\nimport { getCurrentPainelUser } from '@/lib/painel-session';\n\n/* =========================================================\n * Admin (Tenant)\n * ========================================================= */\n\nexport type AdminModule =\n    | 'DASHBOARD'\n    | 'REPORTS'\n    | 'CHECKOUT'\n    | 'APPOINTMENTS'\n    | 'PROFESSIONALS'\n    | 'SERVICES'\n    | 'REVIEWS'\n    | 'PRODUCTS'\n    | 'PARTNERS'\n    | 'CLIENTS'\n    | 'CLIENT_LEVELS'\n    | 'FINANCE'\n    | 'SETTINGS';\n\nexport type AdminSession = {\n    id: string;\n    name: string | null;\n    email: string;\n    role: 'ADMIN';\n    isOwner: boolean;\n    companyId: string;\n\n    // ‚úÖ Multi-unidade fica para depois\n    unitId: null;\n\n    // ‚úÖ Multi-unidade fica para depois (por enquanto sempre true pro owner e false pro resto)\n    canSeeAllUnits: boolean;\n};\n\ntype AdminAccessFlag =\n    | 'canAccessDashboard'\n    | 'canAccessReports'\n    | 'canAccessCheckout'\n    | 'canAccessAppointments'\n    | 'canAccessProfessionals'\n    | 'canAccessServices'\n    | 'canAccessReviews'\n    | 'canAccessProducts'\n    | 'canAccessPartners'\n    | 'canAccessClients'\n    | 'canAccessClientLevels'\n    | 'canAccessFinance'\n    | 'canAccessSettings';\n\ntype AdminAccessSelect = Record<AdminAccessFlag, true>;\nconst ADMIN_ACCESS_SELECT: AdminAccessSelect = {\n    canAccessDashboard: true,\n    canAccessReports: true,\n    canAccessCheckout: true,\n    canAccessAppointments: true,\n    canAccessProfessionals: true,\n    canAccessServices: true,\n    canAccessReviews: true,\n    canAccessProducts: true,\n    canAccessPartners: true,\n    canAccessClients: true,\n    canAccessClientLevels: true,\n    canAccessFinance: true,\n    canAccessSettings: true,\n};\n\nfunction moduleToAccessField(module: AdminModule): AdminAccessFlag | null {\n    switch (module) {\n        case 'DASHBOARD':\n            return 'canAccessDashboard';\n        case 'REPORTS':\n            return 'canAccessReports';\n        case 'CHECKOUT':\n            return 'canAccessCheckout';\n        case 'APPOINTMENTS':\n            return 'canAccessAppointments';\n        case 'PROFESSIONALS':\n            return 'canAccessProfessionals';\n        case 'SERVICES':\n            return 'canAccessServices';\n        case 'REVIEWS':\n            return 'canAccessReviews';\n        case 'PRODUCTS':\n            return 'canAccessProducts';\n\n        // ‚úÖ IMPORTANTE:\n        // Parceiros saiu do ADMIN (tenant) e agora pertence somente √† PLATAFORMA.\n        // Ao retornar null, o guard for√ßa redirect para o primeiro m√≥dulo permitido.\n        case 'PARTNERS':\n            return null;\n\n        case 'CLIENTS':\n            return 'canAccessClients';\n        case 'CLIENT_LEVELS':\n            return 'canAccessClientLevels';\n        case 'FINANCE':\n            return 'canAccessFinance';\n        case 'SETTINGS':\n            return 'canAccessSettings';\n        default:\n            return null;\n    }\n}\n\ntype AdminContext = {\n    id: string;\n    name: string | null;\n    email: string;\n    companyId: string;\n    isOwner: boolean;\n};\n\ntype AdminContextResult =\n    | { ok: true; ctx: AdminContext }\n    | {\n          ok: false;\n          reason:\n              | 'no_session'\n              | 'not_admin'\n              | 'invalid_token'\n              | 'user_inactive'\n              | 'no_membership'\n              | 'no_access';\n      };\n\ntype AdminContextFailureReason = Extract<\n    AdminContextResult,\n    { ok: false }\n>['reason'];\n\nasync function getAdminContext(): Promise<AdminContextResult> {\n    const session = await getCurrentPainelUser();\n\n    if (!session) return { ok: false, reason: 'no_session' };\n\n    // ‚úÖ IMPORTANTE: aqui √© TENANT ADMIN apenas\n    if (session.role !== 'ADMIN') return { ok: false, reason: 'not_admin' };\n\n    const userId = String((session as any).sub || '').trim();\n    const companyId = String((session as any).companyId || '').trim();\n\n    if (!userId || !companyId) return { ok: false, reason: 'invalid_token' };\n\n    const user = await prisma.user.findUnique({\n        where: { id: userId },\n        select: { id: true, name: true, email: true, isActive: true },\n    });\n\n    if (!user?.id || !user.isActive) {\n        return { ok: false, reason: 'user_inactive' };\n    }\n\n    const membership = await prisma.companyMember.findFirst({\n        where: {\n            userId,\n            companyId,\n            isActive: true,\n            role: { in: ['OWNER', 'ADMIN'] },\n        },\n        select: { role: true },\n    });\n\n    if (!membership?.role) return { ok: false, reason: 'no_membership' };\n\n    const isOwner = membership.role === 'OWNER';\n\n    // ‚úÖ Sub-admin precisa existir em AdminAccess (OWNER n√£o precisa)\n    if (!isOwner) {\n        const accessExists = await prisma.adminAccess.findFirst({\n            where: { userId, companyId },\n            select: { id: true },\n        });\n\n        if (!accessExists?.id) return { ok: false, reason: 'no_access' };\n    }\n\n    return {\n        ok: true,\n        ctx: {\n            id: user.id,\n            name: user.name ?? null,\n            email: user.email,\n            companyId,\n            isOwner,\n        },\n    };\n}\n\nfunction redirectToLoginByReason(reason: AdminContextFailureReason): never {\n    switch (reason) {\n        case 'no_session':\n            redirect('/painel/login?error=credenciais');\n        case 'not_admin':\n            redirect('/painel/login?error=permissao');\n        case 'invalid_token':\n        case 'user_inactive':\n        case 'no_membership':\n        case 'no_access':\n        default:\n            redirect('/painel/login?error=permissao');\n    }\n}\n\ntype ModuleRoute = { module: AdminModule; href: string };\n\n/**\n * ‚úÖ Ordem de ‚Äúmelhor destino‚Äù quando falta permiss√£o.\n *\n * Mantemos DASHBOARD por √∫ltimo (se for o √∫nico liberado, vira fallback final).\n * O restante segue a ordem do menu que voc√™ pediu.\n */\nconst FALLBACK_ROUTES: ModuleRoute[] = [\n    { module: 'APPOINTMENTS', href: '/admin/appointments' },\n    { module: 'CHECKOUT', href: '/admin/checkout' },\n    {\n        module: 'PROFESSIONALS',\n        // ‚úÖ FIX: rota correta (plural)\n        href: '/admin/professionals',\n    },\n    { module: 'SERVICES', href: '/admin/services' },\n    { module: 'PRODUCTS', href: '/admin/products' },\n\n    // ‚úÖ PARTNERS REMOVIDO do fallback (agora √© somente da PLATAFORMA)\n\n    { module: 'CLIENTS', href: '/admin/clients' },\n    { module: 'CLIENT_LEVELS', href: '/admin/client-levels' },\n    { module: 'REVIEWS', href: '/admin/review-tags' },\n    { module: 'REPORTS', href: '/admin/reports' },\n    { module: 'FINANCE', href: '/admin/finance' },\n    { module: 'SETTINGS', href: '/admin/setting' },\n    // deixa dashboard por √∫ltimo\n    { module: 'DASHBOARD', href: '/admin/dashboard' },\n];\n\nfunction pickFirstAllowedHref(\n    access: Record<string, any> | null\n): string | null {\n    if (!access) return null;\n\n    for (const r of FALLBACK_ROUTES) {\n        const flag = moduleToAccessField(r.module);\n        if (!flag) continue;\n        if (Boolean((access as any)[flag])) return r.href;\n    }\n\n    return null;\n}\n\nasync function redirectToFirstAllowedOrLogin(params: {\n    companyId: string;\n    userId: string;\n}): Promise<never> {\n    const access = await prisma.adminAccess.findFirst({\n        where: { companyId: params.companyId, userId: params.userId },\n        select: ADMIN_ACCESS_SELECT,\n    });\n\n    const href = pickFirstAllowedHref(access as any);\n    if (href) {\n        redirect(`${href}?error=permissao`);\n        throw new Error('unreachable');\n    }\n\n    redirect('/painel/login?error=permissao');\n    throw new Error('unreachable');\n}\n\n/**\n * ‚úÖ Server Components / Layouts / Pages (bloqueia com redirect)\n */\nexport async function requireAdminForModule(\n    module: AdminModule\n): Promise<AdminSession> {\n    const res = await getAdminContext();\n\n    if (!res.ok) {\n        redirectToLoginByReason(res.reason);\n    }\n\n    const ctx = res.ctx;\n\n    // OWNER: tudo liberado (mas mesmo assim, PARTNERS n√£o existe mais no Admin)\n    if (ctx.isOwner) {\n        // ‚úÖ Se tentarem acessar PARTNERS como admin-owner tenant, cai no redirect padr√£o\n        if (module === 'PARTNERS') {\n            await redirectToFirstAllowedOrLogin({\n                companyId: ctx.companyId,\n                userId: ctx.id,\n            });\n            throw new Error('unreachable');\n        }\n\n        return {\n            id: ctx.id,\n            name: ctx.name,\n            email: ctx.email,\n            role: 'ADMIN',\n            isOwner: true,\n            companyId: ctx.companyId,\n            unitId: null,\n            canSeeAllUnits: true,\n        };\n    }\n\n    const accessField = moduleToAccessField(module);\n    if (!accessField) {\n        await redirectToFirstAllowedOrLogin({\n            companyId: ctx.companyId,\n            userId: ctx.id,\n        });\n        throw new Error('unreachable');\n    }\n\n    const access = await prisma.adminAccess.findFirst({\n        where: { userId: ctx.id, companyId: ctx.companyId },\n        select: ADMIN_ACCESS_SELECT,\n    });\n\n    if (!access) {\n        await redirectToFirstAllowedOrLogin({\n            companyId: ctx.companyId,\n            userId: ctx.id,\n        });\n        throw new Error('unreachable');\n    }\n\n    const allowed = Boolean(access[accessField]);\n    if (!allowed) {\n        await redirectToFirstAllowedOrLogin({\n            companyId: ctx.companyId,\n            userId: ctx.id,\n        });\n        throw new Error('unreachable');\n    }\n\n    return {\n        id: ctx.id,\n        name: ctx.name,\n        email: ctx.email,\n        role: 'ADMIN',\n        isOwner: false,\n        companyId: ctx.companyId,\n        unitId: null,\n        canSeeAllUnits: false,\n    };\n}\n\n/**\n * ‚úÖ Route Handlers /api (bloqueia com 403 JSON)\n *\n * Uso:\n * const res = await requireAdminForModuleApi('DASHBOARD');\n * if (res instanceof NextResponse) return res;\n * const session = res;\n */\nexport async function requireAdminForModuleApi(\n    module: AdminModule\n): Promise<AdminSession | NextResponse> {\n    const res = await getAdminContext();\n\n    if (!res.ok) {\n        return NextResponse.json(\n            { ok: false, error: 'unauthorized' },\n            { status: 401 }\n        );\n    }\n\n    const ctx = res.ctx;\n\n    if (ctx.isOwner) {\n        // ‚úÖ trava PARTNERS tamb√©m na API do Admin\n        if (module === 'PARTNERS') {\n            return NextResponse.json(\n                { ok: false, error: 'forbidden' },\n                { status: 403 }\n            );\n        }\n\n        return {\n            id: ctx.id,\n            name: ctx.name,\n            email: ctx.email,\n            role: 'ADMIN',\n            isOwner: true,\n            companyId: ctx.companyId,\n            unitId: null,\n            canSeeAllUnits: true,\n        };\n    }\n\n    const accessField = moduleToAccessField(module);\n    if (!accessField) {\n        return NextResponse.json(\n            { ok: false, error: 'forbidden' },\n            { status: 403 }\n        );\n    }\n\n    const access = await prisma.adminAccess.findFirst({\n        where: { userId: ctx.id, companyId: ctx.companyId },\n        select: ADMIN_ACCESS_SELECT,\n    });\n\n    if (!access || !Boolean(access[accessField])) {\n        const fallbackHref = pickFirstAllowedHref(access as any);\n        return NextResponse.json(\n            { ok: false, error: 'forbidden', fallback: fallbackHref },\n            { status: 403 }\n        );\n    }\n\n    return {\n        id: ctx.id,\n        name: ctx.name,\n        email: ctx.email,\n        role: 'ADMIN',\n        isOwner: false,\n        companyId: ctx.companyId,\n        unitId: null,\n        canSeeAllUnits: false,\n    };\n}\n\n/* =========================================================\n * Platform (AtendePlay)\n * ========================================================= *\n * ‚úÖ MOVED OUT:\n * A plataforma agora vive em src/lib/platform-permissions.ts\n * Mantemos re-export aqui por compat (caso algum import antigo exista).\n */\n\nexport type {\n    PlatformModule,\n    PlatformSession,\n} from '@/lib/plataform-permissions';\nexport {\n    requirePlatformForModule,\n    requirePlatformForModuleApi,\n} from '@/lib/plataform-permissions';\n\n/**\n * Mantive esse export porque voc√™ j√° usou em outros pontos.\n * Implementamos de verdade quando chegar no painel do profissional.\n */\nexport async function requireProfessionalSession(): Promise<never> {\n    throw new Error(\n        'requireProfessionalSession ainda n√£o foi implementado (n√£o √© necess√°rio neste passo).'\n    );\n}\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/admin/appointments/admin-appointments-client.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/admin/appointments/admin-appointments-client.tsx\",\n    \"default\",\n);\n","// src/app/admin/appointments/page.tsx\nimport type { Metadata } from 'next';\nimport { redirect } from 'next/navigation';\n\nimport { prisma } from '@/lib/prisma';\nimport { requireAdminForModule } from '@/lib/admin-permissions';\nimport AdminAppointmentsClient from './admin-appointments-client';\n\nexport const dynamic = 'force-dynamic';\n\nexport const metadata: Metadata = {\n    title: 'Admin | Agendamentos',\n};\n\ntype AdminAppointmentsPageProps = {\n    searchParams: Promise<{\n        unit?: string; // \"all\" | unitId (mantemos compat com \"all\", mas redireciona)\n        date?: string; // yyyy-MM-dd (S√£o Paulo)\n    }>;\n};\n\nconst SAO_PAULO_UTC_OFFSET_HOURS = 3; // SP = UTC-03 => 00:00 SP = 03:00 UTC\n\nfunction buildAppointmentsRedirect(params: { unit?: string; date?: string }) {\n    const sp = new URLSearchParams();\n    if (params.unit) sp.set('unit', params.unit);\n    if (params.date) sp.set('date', params.date);\n    const qs = sp.toString();\n    return qs ? `/admin/appointments?${qs}` : '/admin/appointments';\n}\n\nfunction parseDateParam(\n    dateStr?: string\n): { y: number; m: number; d: number } | null {\n    if (!dateStr) return null;\n    const [y, m, d] = dateStr.split('-').map(Number);\n    if (!y || !m || !d) return null;\n    return { y, m, d };\n}\n\nfunction ymdToString(ymd: { y: number; m: number; d: number }): string {\n    const y = String(ymd.y).padStart(4, '0');\n    const m = String(ymd.m).padStart(2, '0');\n    const d = String(ymd.d).padStart(2, '0');\n    return `${y}-${m}-${d}`;\n}\n\n/**\n * ‚ÄúHoje‚Äù em S√£o Paulo (retorna Y/M/D), independente do timezone do server.\n */\nfunction getSaoPauloTodayYmd(): { y: number; m: number; d: number } {\n    const now = new Date();\n\n    const formatter = new Intl.DateTimeFormat('pt-BR', {\n        timeZone: 'America/Sao_Paulo',\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit',\n    });\n\n    const parts = formatter.formatToParts(now);\n    const d = Number(parts.find((p) => p.type === 'day')?.value ?? '1');\n    const m = Number(parts.find((p) => p.type === 'month')?.value ?? '1');\n    const y = Number(parts.find((p) => p.type === 'year')?.value ?? '1970');\n\n    return { y, m, d };\n}\n\n/**\n * Converte o ‚Äúdia SP‚Äù para range UTC (pra filtrar scheduleAt em UTC no banco).\n * startUtc = 00:00 SP (03:00Z)\n * endUtc   = 23:59:59.999 SP (02:59:59.999Z do dia seguinte)\n */\nfunction buildSaoPauloDayUtcRange(ymd: { y: number; m: number; d: number }) {\n    const { y, m, d } = ymd;\n\n    const startUtcMs = Date.UTC(\n        y,\n        m - 1,\n        d,\n        SAO_PAULO_UTC_OFFSET_HOURS,\n        0,\n        0,\n        0\n    );\n    const nextDayStartUtcMs = Date.UTC(\n        y,\n        m - 1,\n        d + 1,\n        SAO_PAULO_UTC_OFFSET_HOURS,\n        0,\n        0,\n        0\n    );\n\n    const startUtc = new Date(startUtcMs);\n    const endUtc = new Date(nextDayStartUtcMs - 1);\n\n    return { startUtc, endUtc };\n}\n\nexport default async function AdminAppointmentsPage({\n    searchParams,\n}: AdminAppointmentsPageProps) {\n    const session = await requireAdminForModule('APPOINTMENTS');\n\n    // üîí Hard lock multi-tenant\n    const companyId = session.companyId;\n    if (!companyId) redirect('/admin');\n\n    // ‚úÖ AdminSession usa `id` (n√£o `userId`)\n    const userId = session.id;\n    if (!userId) redirect('/admin');\n\n    const canSeeAllUnits = session.canSeeAllUnits;\n\n    const { unit: unitParam, date: dateParam } = await searchParams;\n\n    // ‚úÖ Unidades acess√≠veis\n    const units = canSeeAllUnits\n        ? await prisma.unit.findMany({\n              where: { companyId, isActive: true },\n              select: { id: true, name: true },\n              orderBy: { name: 'asc' },\n          })\n        : await (async () => {\n              const access = await prisma.adminUnitAccess.findMany({\n                  where: { companyId, userId },\n                  select: { unitId: true },\n              });\n\n              const unitIds = access.map((a) => a.unitId).filter(Boolean);\n              if (!unitIds.length) return [];\n\n              return prisma.unit.findMany({\n                  where: {\n                      companyId,\n                      isActive: true,\n                      id: { in: unitIds },\n                  },\n                  select: { id: true, name: true },\n                  orderBy: { name: 'asc' },\n              });\n          })();\n\n    // ‚úÖ Default unit: sempre cair numa unidade real quando existir\n    const defaultUnitId = units.length > 0 ? units[0].id : null;\n\n    // ‚úÖ Data (dia SP) padronizada\n    const parsed = parseDateParam(dateParam);\n    const ymd = parsed ?? getSaoPauloTodayYmd();\n    const dateStrSp = ymdToString(ymd);\n\n    // ‚úÖ Canoniza a unit (compat com \"all\" / vazio)\n    if (defaultUnitId && (!unitParam || unitParam === 'all')) {\n        redirect(\n            buildAppointmentsRedirect({ unit: defaultUnitId, date: dateStrSp })\n        );\n    }\n\n    // ‚úÖ Unidade ativa (quando n√£o existe default, fica null)\n    const activeUnitId =\n        unitParam && unitParam !== 'all' ? unitParam : defaultUnitId;\n\n    // ‚úÖ Valida que a unit est√° acess√≠vel nesta tela\n    const activeUnit = activeUnitId\n        ? (units.find((u) => u.id === activeUnitId) ?? null)\n        : null;\n\n    if (activeUnitId && !activeUnit && defaultUnitId) {\n        redirect(\n            buildAppointmentsRedirect({ unit: defaultUnitId, date: dateStrSp })\n        );\n    }\n\n    // ‚úÖ Canoniza a date: se veio vazia/inv√°lida, redireciona com a data calculada\n    // (evita UI mostrando ‚Äúhoje‚Äù, mas URL sem date)\n    if (activeUnitId && (!dateParam || !parsed)) {\n        // evita loop se por algum motivo j√° estiver igual\n        if (dateParam !== dateStrSp) {\n            redirect(\n                buildAppointmentsRedirect({\n                    unit: activeUnitId,\n                    date: dateStrSp,\n                })\n            );\n        }\n    }\n\n    const scopeLabel =\n        activeUnit?.name ??\n        (canSeeAllUnits ? 'todas as unidades' : 'unidade selecionada');\n\n    // ‚úÖ range UTC do ‚Äúdia SP‚Äù\n    const { startUtc, endUtc } = buildSaoPauloDayUtcRange(ymd);\n\n    // ‚úÖ Se n√£o h√° unidade acess√≠vel, devolve tela vazia (sem quebrar)\n    if (!activeUnitId) {\n        return (\n            <AdminAppointmentsClient\n                scopeLabel={scopeLabel}\n                date={dateStrSp}\n                activeUnitId={null}\n                units={units}\n                appointments={[]}\n                professionals={[]}\n                services={[]}\n                clients={[]}\n            />\n        );\n    }\n\n    const [\n        appointmentsPrisma,\n        professionalsPrisma,\n        servicesPrisma,\n        clientsPrisma,\n    ] = await Promise.all([\n        prisma.appointment.findMany({\n            where: {\n                companyId,\n                unitId: activeUnitId,\n                scheduleAt: {\n                    gte: startUtc,\n                    lte: endUtc,\n                },\n            },\n            orderBy: { scheduleAt: 'asc' },\n            include: {\n                professional: {\n                    select: {\n                        id: true,\n                        name: true,\n                        imageUrl: true,\n                        isActive: true,\n                    },\n                },\n                client: {\n                    select: {\n                        id: true,\n                        name: true,\n                        phone: true,\n                        image: true,\n                        isActive: true,\n                    },\n                },\n                service: {\n                    select: {\n                        id: true,\n                        name: true,\n                        durationMinutes: true,\n                        price: true,\n                        isActive: true,\n                    },\n                },\n            },\n        }),\n\n        prisma.professional.findMany({\n            where: {\n                companyId,\n                isActive: true,\n                units: {\n                    some: {\n                        unitId: activeUnitId,\n                        isActive: true,\n                    },\n                },\n            },\n            orderBy: { name: 'asc' },\n            select: {\n                id: true,\n                name: true,\n                imageUrl: true,\n                isActive: true,\n            },\n        }),\n\n        prisma.service.findMany({\n            where: {\n                companyId,\n                isActive: true,\n                OR: [{ unitId: activeUnitId }, { unitId: null }],\n            },\n            orderBy: { name: 'asc' },\n            select: {\n                id: true,\n                name: true,\n                durationMinutes: true,\n                price: true,\n                isActive: true,\n                unitId: true, // ‚úÖ necess√°rio pro modal filtrar servi√ßos por unidade\n            },\n        }),\n\n        prisma.user.findMany({\n            where: {\n                isActive: true,\n                companyMemberships: {\n                    some: {\n                        companyId,\n                        isActive: true,\n                        role: 'CLIENT',\n                    },\n                },\n            },\n            orderBy: { name: 'asc' },\n            take: 200,\n            select: {\n                id: true,\n                name: true,\n                phone: true,\n            },\n        }),\n    ]);\n\n    const appointments = appointmentsPrisma.map((a) => ({\n        id: a.id,\n        unitId: a.unitId,\n\n        clientId: a.clientId,\n        clientName: a.clientName,\n        phone: a.phone,\n\n        description: a.description,\n\n        scheduleAt: a.scheduleAt,\n\n        status: a.status,\n\n        professionalId: a.professionalId ?? null,\n        professional: a.professional\n            ? {\n                  id: a.professional.id,\n                  name: a.professional.name,\n                  imageUrl: a.professional.imageUrl ?? null,\n              }\n            : null,\n\n        serviceId: a.serviceId ?? null,\n    }));\n\n    const professionals = professionalsPrisma.map((p) => ({\n        id: p.id,\n        name: p.name,\n        imageUrl: p.imageUrl ?? null,\n        isActive: p.isActive,\n    }));\n\n    const services = servicesPrisma.map((s) => ({\n        id: s.id,\n        name: s.name,\n        durationMinutes: s.durationMinutes,\n        price: s.price ? Number(s.price) : undefined,\n        isActive: s.isActive,\n        unitId: s.unitId ?? null, // ‚úÖ necess√°rio pro modal\n    }));\n\n    const clients = clientsPrisma\n        .map((c) => ({\n            id: c.id,\n            name: (c.name ?? '').trim(),\n            phone: (c.phone ?? '').trim() || null,\n        }))\n        .filter((c) => c.name.length > 0);\n\n    return (\n        <AdminAppointmentsClient\n            scopeLabel={scopeLabel}\n            date={dateStrSp}\n            activeUnitId={activeUnitId}\n            units={units}\n            appointments={appointments}\n            professionals={professionals}\n            services={services}\n            clients={clients}\n        />\n    );\n}\n"],"names":[],"mappings":"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","ignoreList":[1]}