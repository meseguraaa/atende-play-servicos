module.exports=[633568,e=>{"use strict";var t=e.i(154154),r=e.i(140407),a=e.i(493068),i=e.i(821498),n=e.i(161599),o=e.i(182716),l=e.i(857635),s=e.i(337047),d=e.i(528171),u=e.i(367300),c=e.i(102610),p=e.i(670893),m=e.i(902769),h=e.i(46094),f=e.i(622730),v=e.i(811178),g=e.i(193695);e.i(629399);var y=e.i(377404),E=e.i(738342),w=e.i(698043);e.i(212669);var A=e.i(331751);function R(e,t){return E.NextResponse.json({ok:!0,data:e},t)}function b(e,t=400){return E.NextResponse.json({ok:!1,error:e},{status:t})}function U(e){let t=String(e??"").trim();return t.length?t:""}function C(e){let t=String(e??"").trim();return t.length?t:null}function x(e,t,r){let a="number"==typeof e?e:Number(String(e??"").trim().replace(",","."));if(!Number.isFinite(a))return t;let i=Math.floor(a);return Math.max(r?.min??-1/0,Math.min(r?.max??1/0,i))}function S(e,t){let r=t.toLowerCase();for(let[t,a]of e.headers.entries())if(t.toLowerCase()===r){let e=String(a??"").trim();return e.length?e:null}return null}function L(e){let t=S(e,"x-forwarded-proto"),r=S(e,"x-forwarded-host")||S(e,"host"),a=String(t??"").split(",")[0].trim().toLowerCase(),i=String(r??"").split(",")[0].trim();if(i)return`${"http"===a||"https"===a?a:"https"}://${i}`;try{return new URL(e.url).origin}catch{return""}}function P(e,t){let r=String(t??"").trim();if(!r)return null;let a=r.toLowerCase();if(a.startsWith("http://")||a.startsWith("https://"))return r;let i=r.startsWith("/")?r:`/${r}`,n=e.endsWith("/")?e.slice(0,-1):e;return n?`${n}${i}`:i}function I(e){let t=String(e??"").trim();if(!t)return null;let r=t.toLowerCase();return r.startsWith("javascript:")||r.startsWith("data:")?null:r.startsWith("http://")||r.startsWith("https://")?t:r.startsWith("www.")?`https://${t}`:null}function M(e){return"SELECTED"===String(e??"").trim().toUpperCase()?"SELECTED":"ALL"}async function T(e,t){let r=await (0,A.requirePlatformForModuleApi)("PARTNERS");if(r instanceof E.NextResponse)return r;try{let r=L(e),{partnerId:a}=await t.params,i=U(a);if(!i)return b("partnerId é obrigatório.",400);let n=await w.prisma.partner.findFirst({where:{id:i},select:{id:!0,name:!0,logoUrl:!0,logoKey:!0,discountPct:!0,description:!0,rules:!0,ctaUrl:!0,ctaLabel:!0,isActive:!0,visibilityMode:!0,sortOrder:!0,createdAt:!0,updatedAt:!0,companies:{where:{isEnabled:!0},select:{companyId:!0},orderBy:[{createdAt:"asc"},{id:"asc"}]}}});if(!n)return b("Parceiro não encontrado.",404);let o=M(n.visibilityMode),l=I(n.ctaUrl),s=P(r,n.logoUrl);return R({partner:{id:n.id,name:n.name,logoUrl:s,logoKey:n.logoKey??null,discountPct:x(n.discountPct,0,{min:0,max:100}),description:n.description??null,rules:n.rules??null,ctaUrl:l??null,ctaLabel:n.ctaLabel??null,isActive:!!n.isActive,visibilityMode:o,sortOrder:x(n.sortOrder,100,{min:0,max:1e5}),createdAt:n.createdAt,updatedAt:n.updatedAt},companyIds:"SELECTED"===o?n.companies.map(e=>e.companyId):[]})}catch(e){return console.error("[platform partners get] error:",e),b("Erro ao acessar parceiro.",500)}}async function N(e,t){let r=await (0,A.requirePlatformForModuleApi)("PARTNERS");if(r instanceof E.NextResponse)return r;try{let r=L(e),{partnerId:a}=await t.params,i=U(a);if(!i)return b("partnerId é obrigatório.",400);let n=await e.json().catch(()=>null);if(!n)return b("Body inválido.",400);let o=await w.prisma.partner.findFirst({where:{id:i},select:{id:!0,isActive:!0,name:!0,logoUrl:!0,logoKey:!0,discountPct:!0,description:!0,rules:!0,ctaUrl:!0,ctaLabel:!0,visibilityMode:!0,sortOrder:!0}});if(!o)return b("Parceiro não encontrado.",404);if("toggleActive"in n&&!0===n.toggleActive){let e=await w.prisma.partner.update({where:{id:o.id},data:{isActive:!o.isActive},select:{id:!0,isActive:!0}});return R({id:e.id,isActive:e.isActive})}if(!("update"in n)||!n.update||"object"!=typeof n.update)return b("Patch inválido.",400);let l=n.update,s=void 0!==l.name?U(l.name):o.name,d=void 0!==l.logoUrl?C(l.logoUrl):o.logoUrl??null,u=void 0!==l.logoKey?C(l.logoKey):o.logoKey??null,c=x(void 0!==l.discountPct?l.discountPct:o.discountPct,0,{min:0,max:100}),p=void 0!==l.description?C(l.description):o.description??null,m=void 0!==l.rules?C(l.rules):o.rules??null,h=void 0!==l.ctaUrl?I(l.ctaUrl):I(o.ctaUrl),f=void 0!==l.ctaLabel?C(l.ctaLabel):o.ctaLabel??null,v=M(o.visibilityMode??"ALL"),g=void 0!==l.visibilityMode?M(l.visibilityMode):v,y=x(void 0!==l.sortOrder?l.sortOrder:o.sortOrder,100,{min:0,max:1e5}),E=void 0!==l.companyIds,A=E?function(e){if(!Array.isArray(e))return[];let t=e.map(e=>String(e??"").trim()).filter(Boolean),r=new Set,a=[];for(let e of t)r.has(e)||(r.add(e),a.push(e));return a}(l.companyIds):[];if(!s)return b("Nome é obrigatório.",400);if(!d)return b("logoUrl é obrigatório.",400);if(!function(e){let t=String(e??"").trim();if(!t)return!1;let r=t.toLowerCase();return!(r.startsWith("javascript:")||r.startsWith("data:")||r.startsWith("blob:"))&&!!(t.startsWith("/media/")||t.startsWith("media/")||t.startsWith("/uploads/")||t.startsWith("uploads/")||r.startsWith("http://")||r.startsWith("https://"))}(d))return b("logoUrl inválida. Envie uma imagem (/media ou /uploads) ou forneça uma URL http(s) válida.",400);if(!h)return b("ctaUrl inválida. Informe uma URL http(s) (ou começando com www.).",400);let S=void 0!==l.visibilityMode&&g!==v;if("SELECTED"===g){if((S||E)&&0===A.length)return b("Em SELECTED, você precisa selecionar pelo menos 1 empresa.",400);if(S&&!E)return b("Ao mudar para SELECTED, envie companyIds com pelo menos 1 empresa.",400)}let T=E||S,N=await w.prisma.$transaction(async e=>{let t=await e.partner.update({where:{id:o.id},data:{name:s,logoUrl:d,logoKey:u,discountPct:c,description:p,rules:m,ctaUrl:h,ctaLabel:f||"Ativar cashback e ir pra loja",visibilityMode:g,sortOrder:y},select:{id:!0,isActive:!0,name:!0,logoUrl:!0,logoKey:!0,discountPct:!0,description:!0,rules:!0,ctaUrl:!0,ctaLabel:!0,visibilityMode:!0,sortOrder:!0,updatedAt:!0}});return T?"ALL"===g?(await e.partnerVisibility.deleteMany({where:{partnerId:t.id}}),{partnerUpdated:t,companyIds:[]}):(await e.partnerVisibility.deleteMany({where:{partnerId:t.id}}),A.length&&await e.partnerVisibility.createMany({data:A.map(e=>({partnerId:t.id,companyId:e,isEnabled:!0})),skipDuplicates:!0}),{partnerUpdated:t,companyIds:A}):{partnerUpdated:t,companyIds:null}}),O=[],D=M(N.partnerUpdated.visibilityMode??"ALL");Array.isArray(N.companyIds)?O=N.companyIds:"SELECTED"===D&&(O=(await w.prisma.partnerVisibility.findMany({where:{partnerId:N.partnerUpdated.id,isEnabled:!0},select:{companyId:!0},orderBy:[{createdAt:"asc"},{id:"asc"}]})).map(e=>e.companyId));let W=P(r,N.partnerUpdated.logoUrl);return R({id:N.partnerUpdated.id,partner:{id:N.partnerUpdated.id,name:N.partnerUpdated.name,logoUrl:W,logoKey:N.partnerUpdated.logoKey??null,discountPct:x(N.partnerUpdated.discountPct,0,{min:0,max:100}),description:N.partnerUpdated.description??null,rules:N.partnerUpdated.rules??null,ctaUrl:I(N.partnerUpdated.ctaUrl)??null,ctaLabel:N.partnerUpdated.ctaLabel??null,isActive:!!N.partnerUpdated.isActive,visibilityMode:D,sortOrder:x(N.partnerUpdated.sortOrder,100,{min:0,max:1e5}),updatedAt:N.partnerUpdated.updatedAt},companyIds:"SELECTED"===D?O:[]})}catch(e){return console.error("[platform partners patch] error:",e),b("Erro ao editar parceiro.",500)}}e.s(["GET",()=>T,"PATCH",()=>N,"dynamic",0,"force-dynamic","revalidate",0,0],580472);var O=e.i(580472);let D=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/plataform/partners/[partnerId]/route",pathname:"/api/plataform/partners/[partnerId]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/plataform/partners/[partnerId]/route.ts",nextConfigOutput:"standalone",userland:O}),{workAsyncStorage:W,workUnitAsyncStorage:_,serverHooks:H}=D;function K(){return(0,a.patchFetch)({workAsyncStorage:W,workUnitAsyncStorage:_})}async function k(e,t,a){D.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let E="/api/plataform/partners/[partnerId]/route";E=E.replace(/\/index$/,"")||"/";let w=await D.prepare(e,t,{srcPage:E,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:A,params:R,nextConfig:b,parsedUrl:U,isDraftMode:C,prerenderManifest:x,routerServerContext:S,isOnDemandRevalidate:L,revalidateOnlyGenerated:P,resolvedPathname:I,clientReferenceManifest:M,serverActionsManifest:T}=w,N=(0,s.normalizeAppPath)(E),O=!!(x.dynamicRoutes[N]||x.routes[I]),W=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,U,!1):t.end("This page could not be found"),null);if(O&&!C){let e=!!x.routes[I],t=x.dynamicRoutes[N];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await W();throw new g.NoFallbackError}}let _=null;!O||D.isDev||C||(_="/index"===(_=I)?"/":_);let H=!0===D.isDev||!O,K=O&&!H;T&&M&&(0,o.setReferenceManifestsSingleton)({page:E,clientReferenceManifest:M,serverActionsManifest:T,serverModuleMap:(0,l.createServerModuleMap)({serverActionsManifest:T})});let k=e.method||"GET",q=(0,n.getTracer)(),$=q.getActiveScopeSpan(),j={params:R,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>D.onRequestError(e,t,a,S)},sharedContext:{buildId:A}},F=new d.NodeNextRequest(e),B=new d.NodeNextResponse(t),V=u.NextRequestAdapter.fromNodeNextRequest(F,(0,u.signalFromNodeResponse)(t));try{let o=async e=>D.handle(V,j).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=q.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${k} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${E}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),s=async i=>{var n,s;let d=async({previousCacheEntry:r})=>{try{if(!l&&L&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(i);e.fetchMetrics=j.renderOpts.fetchMetrics;let s=j.renderOpts.pendingWaitUntil;s&&a.waitUntil&&(a.waitUntil(s),s=void 0);let d=j.renderOpts.collectedTags;if(!O)return await (0,m.sendResponse)(F,B,n,j.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[v.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==j.renderOpts.collectedRevalidate&&!(j.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&j.renderOpts.collectedRevalidate,a=void 0===j.renderOpts.collectedExpire||j.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:j.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await D.onRequestError(e,t,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:K,isOnDemandRevalidate:L})},S),t}},u=await D.handleResponse({req:e,nextConfig:b,cacheKey:_,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:L,revalidateOnlyGenerated:P,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:l});if(!O)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(s=u.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",L?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&O||c.delete(v.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(F,B,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};$?await s($):await q.withPropagatedContext(e.headers,()=>q.trace(c.BaseServerSpan.handleRequest,{spanName:`${k} ${E}`,kind:n.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},s))}catch(t){if(t instanceof g.NoFallbackError||await D.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:K,isOnDemandRevalidate:L})}),O)throw t;return await (0,m.sendResponse)(F,B,new Response(null,{status:500})),null}}e.s(["handler",()=>k,"patchFetch",()=>K,"routeModule",()=>D,"serverHooks",()=>H,"workAsyncStorage",()=>W,"workUnitAsyncStorage",()=>_],633568)}];

//# sourceMappingURL=c2dd8_next_dist_esm_build_templates_app-route_6c6e9dab.js.map