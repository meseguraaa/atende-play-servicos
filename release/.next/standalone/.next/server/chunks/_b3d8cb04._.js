module.exports=[968763,192794,231963,e=>{"use strict";let t=Symbol.for("constructDateFrom");function i(e,i){return"function"==typeof e?e(i):e&&"object"==typeof e&&t in e?e[t](i):e instanceof Date?new e.constructor(i):new Date(i)}function a(e,t){return i(t||e,e)}e.s(["constructFromSymbol",0,t,"millisecondsInDay",0,864e5,"millisecondsInHour",0,36e5,"millisecondsInMinute",0,6e4,"millisecondsInSecond",0,1e3,"millisecondsInWeek",0,6048e5],192794),e.s(["constructFrom",()=>i],231963),e.s(["toDate",()=>a],968763)},896407,e=>{"use strict";var t=e.i(698043),i=e.i(52359);async function a(){let e=await (0,i.getCurrentPainelUser)();if(!e||"PROFESSIONAL"!==e.role)return{companyId:"",professionalId:"",userId:"",unitId:""};let a=String(e.sub||"").trim(),n=String(e.companyId||"").trim();if(!a||!n)return{companyId:"",professionalId:"",userId:"",unitId:""};let r=await t.prisma.professional.findFirst({where:{userId:a,companyId:n,isActive:!0},select:{id:!0,name:!0,email:!0}});if(!r?.id)return{companyId:"",professionalId:"",userId:a,unitId:""};let s=await t.prisma.professionalUnit.findFirst({where:{companyId:n,professionalId:r.id,isActive:!0},select:{unitId:!0},orderBy:{updatedAt:"desc"}});return{companyId:n,professionalId:r.id,userId:a,unitId:s?.unitId??"",name:r.name??null,email:r.email}}e.s(["requireProfessionalSession",()=>a])},88795,e=>{"use strict";var t=e.i(154154),i=e.i(140407),a=e.i(493068),n=e.i(821498),r=e.i(161599),s=e.i(182716),o=e.i(857635),l=e.i(337047),d=e.i(528171),u=e.i(367300),c=e.i(102610),p=e.i(670893),m=e.i(902769),f=e.i(46094),y=e.i(622730),v=e.i(811178),I=e.i(193695);e.i(629399);var h=e.i(377404),g=e.i(738342),R=e.i(205918),w=e.i(451305),A=e.i(698043),E=e.i(896407),S=e.i(29173);function T(e,t=200){return g.NextResponse.json({ok:!0,data:e},{status:t})}function b(e,t=400){return g.NextResponse.json({ok:!1,error:e},{status:t})}function _(e){let[t,i,a]=String(e??"").slice(0,10).split("-"),n=Number(t),r=Number(i),s=Number(a);return!Number.isInteger(n)||!Number.isInteger(r)||!Number.isInteger(s)||r<1||r>12||s<1||s>31?null:new Date(Date.UTC(n,r-1,s,12,0,0,0))}async function x(){let e=await (0,E.requireProfessionalSession)(),t=String(e.companyId||"").trim(),i=String(e.professionalId||"").trim(),a=String(e.unitId||"").trim();if(!t)throw Error("missing_company");if(!i)throw Error("missing_professional");if(!a||!await A.prisma.professionalUnit.findFirst({where:{companyId:t,professionalId:i,unitId:a,isActive:!0,unit:{isActive:!0}},select:{id:!0}}))throw Error("missing_active_unit");return{companyId:t,professionalId:i,unitId:a}}async function C(){try{let e=await x(),t=await A.prisma.professionalDailyAvailability.findMany({where:{companyId:e.companyId,professionalId:e.professionalId,unitId:e.unitId},include:{intervals:!0},orderBy:{date:"asc"}});return T({exceptions:t.map(e=>({id:e.id,dateISO:(0,w.format)(e.date,"yyyy-MM-dd"),type:e.type===S.ProfessionalDailyAvailabilityType.DAY_OFF?"DAY_OFF":"CUSTOM",intervals:e.intervals.map(e=>({id:e.id,startTime:e.startTime,endTime:e.endTime}))}))})}catch(e){return b(e?.message==="missing_company"?"Sessão sem companyId.":e?.message==="missing_professional"?"Sessão sem professionalId.":e?.message==="missing_active_unit"?"Este profissional não possui unidade ativa vinculada.":"Erro ao buscar exceções.",401)}}async function P(e){try{let t=await x(),i=await e.json(),a=String(i?.dateISO??""),n=i?.mode;if(!a)return b("dateISO é obrigatório.",400);if("FULL_DAY"!==n&&"PARTIAL"!==n)return b("mode inválido. Use FULL_DAY ou PARTIAL.",400);let r=_(a);if(!r)return b("dateISO inválido. Use yyyy-MM-dd.",400);let s=Array.isArray(i?.intervals)?i.intervals:[];if("PARTIAL"===n){if(!s.length)return b("Adicione pelo menos 1 intervalo.",400);for(let e of s)if(!e?.startTime||!e?.endTime||e.startTime>=e.endTime)return b("Intervalos inválidos: o horário inicial deve ser menor que o final.",400)}let o="FULL_DAY"===n?S.ProfessionalDailyAvailabilityType.DAY_OFF:S.ProfessionalDailyAvailabilityType.CUSTOM,l=await A.prisma.$transaction(async e=>{let i=await e.professionalDailyAvailability.upsert({where:{professionalId_unitId_date:{professionalId:t.professionalId,unitId:t.unitId,date:r}},create:{companyId:t.companyId,professionalId:t.professionalId,unitId:t.unitId,date:r,type:o},update:{type:o},select:{id:!0}});return await e.professionalDailyTimeInterval.deleteMany({where:{dailyAvailabilityId:i.id}}),"PARTIAL"===n&&await e.professionalDailyTimeInterval.createMany({data:s.map(e=>({dailyAvailabilityId:i.id,startTime:e.startTime,endTime:e.endTime}))}),i});return(0,R.revalidatePath)("/professional/availability"),T({id:l.id})}catch(e){return b(e?.message==="missing_company"?"Sessão sem companyId.":e?.message==="missing_professional"?"Sessão sem professionalId.":e?.message==="missing_active_unit"?"Este profissional não possui unidade ativa vinculada.":"Erro ao salvar exceção.",401)}}async function O(e){try{let t=await x(),{searchParams:i}=new URL(e.url),a=i.get("dateISO");if(!a)return b("dateISO é obrigatório.",400);let n=_(a);if(!n)return b("dateISO inválido. Use yyyy-MM-dd.",400);return await A.prisma.professionalDailyAvailability.delete({where:{professionalId_unitId_date:{professionalId:t.professionalId,unitId:t.unitId,date:n}}}),(0,R.revalidatePath)("/professional/availability"),T({deleted:!0})}catch(i){let e=String(i?.code??""),t=String(i?.message??"");if("P2025"===e||t.includes("Record to delete does not exist"))return T({deleted:!0});return b(i?.message==="missing_company"?"Sessão sem companyId.":i?.message==="missing_professional"?"Sessão sem professionalId.":i?.message==="missing_active_unit"?"Este profissional não possui unidade ativa vinculada.":"Erro ao remover exceção.",401)}}e.s(["DELETE",()=>O,"GET",()=>C,"POST",()=>P],931858);var D=e.i(931858);let N=new t.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/professional/availability/exceptions/route",pathname:"/api/professional/availability/exceptions",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/professional/availability/exceptions/route.ts",nextConfigOutput:"standalone",userland:D}),{workAsyncStorage:U,workUnitAsyncStorage:M,serverHooks:F}=N;function H(){return(0,a.patchFetch)({workAsyncStorage:U,workUnitAsyncStorage:M})}async function L(e,t,a){N.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let g="/api/professional/availability/exceptions/route";g=g.replace(/\/index$/,"")||"/";let R=await N.prepare(e,t,{srcPage:g,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:w,params:A,nextConfig:E,parsedUrl:S,isDraftMode:T,prerenderManifest:b,routerServerContext:_,isOnDemandRevalidate:x,revalidateOnlyGenerated:C,resolvedPathname:P,clientReferenceManifest:O,serverActionsManifest:D}=R,U=(0,l.normalizeAppPath)(g),M=!!(b.dynamicRoutes[U]||b.routes[P]),F=async()=>((null==_?void 0:_.render404)?await _.render404(e,t,S,!1):t.end("This page could not be found"),null);if(M&&!T){let e=!!b.routes[P],t=b.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await F();throw new I.NoFallbackError}}let H=null;!M||N.isDev||T||(H="/index"===(H=P)?"/":H);let L=!0===N.isDev||!M,q=M&&!L;D&&O&&(0,s.setReferenceManifestsSingleton)({page:g,clientReferenceManifest:O,serverActionsManifest:D,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:D})});let k=e.method||"GET",j=(0,r.getTracer)(),$=j.getActiveScopeSpan(),K={params:A,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:L,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,i,a)=>N.onRequestError(e,t,a,_)},sharedContext:{buildId:w}},B=new d.NodeNextRequest(e),Y=new d.NodeNextResponse(t),G=u.NextRequestAdapter.fromNodeNextRequest(B,(0,u.signalFromNodeResponse)(t));try{let s=async e=>N.handle(G,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let i=j.getRootSpanAttributes();if(!i)return;if(i.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${i.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=i.get("next.route");if(a){let t=`${k} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${g}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var r,l;let d=async({previousCacheEntry:i})=>{try{if(!o&&x&&C&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await s(n);e.fetchMetrics=K.renderOpts.fetchMetrics;let l=K.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=K.renderOpts.collectedTags;if(!M)return await (0,m.sendResponse)(B,Y,r,K.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(r.headers);d&&(t[v.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let i=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,a=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:i,expire:a}}}}catch(t){throw(null==i?void 0:i.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:g,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:x})},_),t}},u=await N.handleResponse({req:e,nextConfig:E,cacheKey:H,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:x,revalidateOnlyGenerated:C,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:o});if(!M)return null;if((null==u||null==(r=u.value)?void 0:r.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",x?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),T&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,f.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&M||c.delete(v.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,y.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(B,Y,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};$?await l($):await j.withPropagatedContext(e.headers,()=>j.trace(c.BaseServerSpan.handleRequest,{spanName:`${k} ${g}`,kind:r.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},l))}catch(t){if(t instanceof I.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:x})}),M)throw t;return await (0,m.sendResponse)(B,Y,new Response(null,{status:500})),null}}e.s(["handler",()=>L,"patchFetch",()=>H,"routeModule",()=>N,"serverHooks",()=>F,"workAsyncStorage",()=>U,"workUnitAsyncStorage",()=>M],88795)}];

//# sourceMappingURL=_b3d8cb04._.js.map