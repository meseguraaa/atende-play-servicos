generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id                               String                           @id @default(cuid())
  name                             String
  slug                             String?
  segment                          CompanySegment                   @default(BARBERSHOP)
  isActive                         Boolean                          @default(true)
  createdAt                        DateTime                         @default(now())
  updatedAt                        DateTime                         @updatedAt
  adminAccesses                    AdminAccess[]
  adminUnitAccesses                AdminUnitAccess[]
  analyticsEvents                  AnalyticsEvent[]
  appointmentReviews               AppointmentReview[]
  appointments                     Appointment[]
  clientPlans                      ClientPlan[]
  members                          CompanyMember[]
  customerLevelConfigs             CustomerLevelConfig[]
  customerLevelPeriods             CustomerLevelPeriod[]
  customerLevelRules               CustomerLevelRule[]
  customerLevelStates              CustomerLevelState[]
  expenses                         Expense[]
  orderItems                       OrderItem[]
  orders                           Order[]
  planServices                     PlanService[]
  plans                            Plan[]
  productDiscountByLevels          ProductDiscountByLevel[]
  productSales                     ProductSale[]
  products                         Product[]
  professionalCancellationFees     ProfessionalCancellationFee[]
  professionalDailyAvailabilities  ProfessionalDailyAvailability[]
  professionalUnits                ProfessionalUnit[]
  professionalWeeklyAvailabilities ProfessionalWeeklyAvailability[]
  professionals                    Professional[]
  reviewTags                       ReviewTag[]
  serviceProfessionals             ServiceProfessional[]
  services                         Service[]
  unitDailyAvailabilities          UnitDailyAvailability[]
  unitWeeklyAvailabilities         UnitWeeklyAvailability[]
  units                            Unit[]

  @@index([segment])
  @@map("companies")
}

model CompanyMember {
  id         String            @id @default(cuid())
  companyId  String
  userId     String
  role       CompanyMemberRole @default(CLIENT)
  isActive   Boolean           @default(true)
  lastUnitId String?
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  company    Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  lastUnit   Unit?             @relation(fields: [lastUnitId], references: [id])
  user       User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([companyId, userId])
  @@index([userId])
  @@index([companyId, role])
  @@map("company_members")
}

model User {
  id                     String                @id @default(cuid())
  name                   String?
  email                  String                @unique
  emailVerified          DateTime?
  image                  String?
  phone                  String?
  passwordHash           String?
  birthday               DateTime?
  role                   Role                  @default(CLIENT)
  isOwner                Boolean               @default(false)
  isActive               Boolean               @default(true)
  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @updatedAt
  accounts               Account[]
  sessions               Session[]
  adminAccesses          AdminAccess[]
  adminUnitAccesses      AdminUnitAccess[]
  analyticsEvents        AnalyticsEvent[]
  reviews                AppointmentReview[]
  appointmentsCancelled  Appointment[]         @relation("AppointmentCancelledByUser")
  appointmentsCheckedOut Appointment[]         @relation("AppointmentCheckedOutByUser")
  appointmentsAsClient   Appointment[]         @relation("ClientAppointments")
  appointmentsConcluded  Appointment[]         @relation("AppointmentConcludedByUser")
  clientPlans            ClientPlan[]
  companyMemberships     CompanyMember[]
  customerLevelPeriods   CustomerLevelPeriod[]
  customerLevelStates    CustomerLevelState[]
  orders                 Order[]
  professional           Professional?
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Unit {
  id        String @id @default(cuid())
  companyId String

  name  String
  phone String?

  // ✅ Endereço estruturado
  cep          String?
  street       String?
  number       String?
  complement   String?
  neighborhood String?
  city         String?
  state        String?

  // ✅ Linha pronta (pode ser gerada)
  address String?

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  adminAccesses                    AdminAccess[]
  adminUnitAccesses                AdminUnitAccess[]
  analyticsEvents                  AnalyticsEvent[]
  appointments                     Appointment[]
  lastUsedByMembers                CompanyMember[]
  customerLevelConfigs             CustomerLevelConfig[]
  customerLevelPeriods             CustomerLevelPeriod[]
  customerLevelRules               CustomerLevelRule[]
  customerLevelStates              CustomerLevelState[]
  expenses                         Expense[]
  orders                           Order[]
  productSales                     ProductSale[]
  products                         Product[]
  cancellationFees                 ProfessionalCancellationFee[]
  professionalDailyAvailabilities  ProfessionalDailyAvailability[]
  professionals                    ProfessionalUnit[]
  professionalWeeklyAvailabilities ProfessionalWeeklyAvailability[]
  services                         Service[]
  dailyAvailabilities              UnitDailyAvailability[]
  weeklyAvailabilities             UnitWeeklyAvailability[]
  company                          Company                          @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("units")
}

model CustomerLevelConfig {
  id                  String        @id @default(cuid())
  companyId           String
  unitId              String
  level               CustomerLevel
  minAppointmentsDone Int           @default(0)
  minOrdersCompleted  Int           @default(0)
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  company             Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  unit                Unit          @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@unique([unitId, level])
  @@index([companyId])
  @@index([unitId])
  @@map("customer_level_configs")
}

model CustomerLevelRule {
  id          String                @id @default(cuid())
  companyId   String
  unitId      String
  type        CustomerLevelRuleType
  targetLevel CustomerLevel
  priority    Int                   @default(100)
  isEnabled   Boolean               @default(true)
  createdAt   DateTime              @default(now())
  updatedAt   DateTime              @updatedAt
  company     Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  unit        Unit                  @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([companyId, isEnabled])
  @@index([unitId, isEnabled])
  @@map("customer_level_rules")
}

model CustomerLevelState {
  id                    String        @id @default(cuid())
  companyId             String
  unitId                String
  userId                String
  levelCurrent          CustomerLevel @default(BRONZE)
  levelEarnedLastPeriod CustomerLevel @default(BRONZE)
  levelEffectiveFrom    DateTime?
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  company               Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  unit                  Unit          @relation(fields: [unitId], references: [id], onDelete: Cascade)
  user                  User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([unitId, userId])
  @@index([companyId])
  @@index([userId])
  @@index([unitId])
  @@map("customer_level_states")
}

model CustomerLevelPeriod {
  id               String        @id @default(cuid())
  companyId        String
  unitId           String
  userId           String
  periodKey        String
  appointmentsDone Int           @default(0)
  ordersCompleted  Int           @default(0)
  earnedLevel      CustomerLevel @default(BRONZE)
  computedAt       DateTime      @default(now())
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  company          Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  unit             Unit          @relation(fields: [unitId], references: [id], onDelete: Cascade)
  user             User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([unitId, userId, periodKey])
  @@index([companyId, periodKey])
  @@index([unitId, periodKey])
  @@index([userId, periodKey])
  @@map("customer_level_periods")
}

model ProfessionalUnit {
  id             String       @id @default(cuid())
  companyId      String
  professionalId String
  unitId         String
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  company        Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  professional   Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  unit           Unit         @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@unique([professionalId, unitId])
  @@index([companyId])
  @@index([unitId])
  @@index([professionalId])
  @@map("professional_units")
}

model UnitWeeklyAvailability {
  id        String                   @id @default(cuid())
  companyId String
  unitId    String
  weekday   Int
  isActive  Boolean                  @default(true)
  createdAt DateTime                 @default(now())
  updatedAt DateTime                 @updatedAt
  company   Company                  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  unit      Unit                     @relation(fields: [unitId], references: [id], onDelete: Cascade)
  intervals UnitWeeklyTimeInterval[]

  @@unique([unitId, weekday])
  @@index([companyId])
  @@map("unit_weekly_availabilities")
}

model UnitWeeklyTimeInterval {
  id                   String                 @id @default(cuid())
  weeklyAvailabilityId String
  startTime            String
  endTime              String
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  weeklyAvailability   UnitWeeklyAvailability @relation(fields: [weeklyAvailabilityId], references: [id], onDelete: Cascade)

  @@map("unit_weekly_time_intervals")
}

model UnitDailyAvailability {
  id        String                  @id @default(cuid())
  companyId String
  unitId    String
  date      DateTime
  isClosed  Boolean                 @default(false)
  createdAt DateTime                @default(now())
  updatedAt DateTime                @updatedAt
  company   Company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  unit      Unit                    @relation(fields: [unitId], references: [id], onDelete: Cascade)
  intervals UnitDailyTimeInterval[]

  @@unique([unitId, date])
  @@index([companyId])
  @@map("unit_daily_availabilities")
}

model UnitDailyTimeInterval {
  id                  String                @id @default(cuid())
  dailyAvailabilityId String
  startTime           String
  endTime             String
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  dailyAvailability   UnitDailyAvailability @relation(fields: [dailyAvailabilityId], references: [id], onDelete: Cascade)

  @@map("unit_daily_time_intervals")
}

model Professional {
  id                    String                           @id @default(cuid())
  companyId             String
  name                  String
  email                 String
  phone                 String?
  isActive              Boolean                          @default(true)
  imageUrl              String?
  createdAt             DateTime                         @default(now())
  updatedAt             DateTime                         @updatedAt
  userId                String?                          @unique
  reviews               AppointmentReview[]
  appointmentsCancelled Appointment[]                    @relation("AppointmentCancelledByProfessional")
  appointmentsConcluded Appointment[]                    @relation("AppointmentConcludedByProfessional")
  appointments          Appointment[]
  orders                Order[]
  productSales          ProductSale[]
  cancellationFees      ProfessionalCancellationFee[]
  dailyAvailabilities   ProfessionalDailyAvailability[]
  units                 ProfessionalUnit[]
  weeklyAvailabilities  ProfessionalWeeklyAvailability[]
  company               Company                          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user                  User?                            @relation(fields: [userId], references: [id])
  services              ServiceProfessional[]

  @@unique([companyId, email])
  @@index([companyId])
  @@map("professionals")
}

model Service {
  id                     String                @id @default(cuid())
  companyId              String
  unitId                 String?
  name                   String
  price                  Decimal               @db.Decimal(10, 2)
  durationMinutes        Int
  isActive               Boolean               @default(true)
  professionalPercentage Decimal               @default(50.0) @db.Decimal(5, 2)
  cancelLimitHours       Int?
  cancelFeePercentage    Decimal?              @db.Decimal(5, 2)
  createdAt              DateTime              @default(now())
  updatedAt              DateTime              @updatedAt
  appointments           Appointment[]
  orderItems             OrderItem[]
  planServices           PlanService[]
  professionals          ServiceProfessional[]
  company                Company               @relation(fields: [companyId], references: [id], onDelete: Cascade)
  unit                   Unit?                 @relation(fields: [unitId], references: [id])

  @@index([companyId])
  @@index([unitId])
  @@map("services")
}

model ServiceProfessional {
  id             String       @id @default(cuid())
  companyId      String
  serviceId      String
  professionalId String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  company        Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  professional   Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  service        Service      @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([serviceId, professionalId])
  @@index([companyId])
  @@index([professionalId])
  @@map("service_professionals")
}

model Plan {
  id                String        @id @default(cuid())
  companyId         String
  name              String
  description       String?
  price             Decimal       @db.Decimal(10, 2)
  durationDays      Int           @default(30)
  totalBookings     Int           @default(4)
  commissionPercent Int
  isActive          Boolean       @default(true)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  clientPlans       ClientPlan[]
  services          PlanService[]
  company           Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@map("plans")
}

model PlanService {
  id        String   @id @default(cuid())
  companyId String
  planId    String
  serviceId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  plan      Plan     @relation(fields: [planId], references: [id], onDelete: Cascade)
  service   Service  @relation(fields: [serviceId], references: [id])

  @@unique([planId, serviceId])
  @@index([companyId])
  @@map("plan_services")
}

model ClientPlan {
  id           String           @id @default(cuid())
  companyId    String
  clientId     String
  planId       String
  startDate    DateTime
  endDate      DateTime
  usedBookings Int              @default(0)
  status       ClientPlanStatus @default(ACTIVE)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  appointments Appointment[]
  client       User             @relation(fields: [clientId], references: [id])
  company      Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  plan         Plan             @relation(fields: [planId], references: [id])

  @@index([companyId])
  @@index([clientId])
  @@index([planId])
  @@map("client_plans")
}

model Appointment {
  id                              String                       @id @default(cuid())
  companyId                       String
  unitId                          String
  description                     String
  clientName                      String
  phone                           String
  scheduleAt                      DateTime
  status                          AppointmentStatus            @default(PENDING)
  clientId                        String
  professionalId                  String?
  serviceId                       String?
  servicePriceAtTheTime           Decimal?                     @db.Decimal(10, 2)
  professionalPercentageAtTheTime Decimal?                     @db.Decimal(5, 2)
  professionalEarningValue        Decimal?                     @db.Decimal(10, 2)
  cancelFeeApplied                Boolean                      @default(false)
  cancelFeeValue                  Decimal?                     @db.Decimal(10, 2)
  cancelledByRole                 Role?
  concludedByRole                 Role?
  cancelledAt                     DateTime?
  doneAt                          DateTime?
  checkedOutAt                    DateTime?
  checkoutFinancialSnapshot       Json?
  checkedOutByUserId              String?
  concludedByUserId               String?
  concludedByProfessionalId       String?
  cancelledByUserId               String?
  cancelledByProfessionalId       String?
  clientPlanId                    String?
  reviewModalShown                Boolean                      @default(false)
  createdAt                       DateTime                     @default(now())
  updatedAt                       DateTime                     @updatedAt
  review                          AppointmentReview?
  cancelledByProfessional         Professional?                @relation("AppointmentCancelledByProfessional", fields: [cancelledByProfessionalId], references: [id])
  cancelledByUser                 User?                        @relation("AppointmentCancelledByUser", fields: [cancelledByUserId], references: [id])
  checkedOutByUser                User?                        @relation("AppointmentCheckedOutByUser", fields: [checkedOutByUserId], references: [id])
  client                          User                         @relation("ClientAppointments", fields: [clientId], references: [id])
  clientPlan                      ClientPlan?                  @relation(fields: [clientPlanId], references: [id])
  company                         Company                      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  concludedByProfessional         Professional?                @relation("AppointmentConcludedByProfessional", fields: [concludedByProfessionalId], references: [id])
  concludedByUser                 User?                        @relation("AppointmentConcludedByUser", fields: [concludedByUserId], references: [id])
  professional                    Professional?                @relation(fields: [professionalId], references: [id])
  service                         Service?                     @relation(fields: [serviceId], references: [id])
  unit                            Unit                         @relation(fields: [unitId], references: [id], onDelete: Cascade)
  order                           Order?                       @relation("AppointmentOrder")
  cancellationFee                 ProfessionalCancellationFee?

  @@index([companyId])
  @@index([unitId])
  @@index([clientId])
  @@index([professionalId])
  @@index([scheduleAt])
  @@index([serviceId])
  @@index([clientPlanId])
  @@index([professionalId, scheduleAt])
  @@index([concludedByUserId])
  @@index([concludedByProfessionalId])
  @@index([cancelledByUserId])
  @@index([cancelledByProfessionalId])
  @@index([status, cancelledAt])
  @@index([doneAt])
  @@index([checkedOutAt])
  @@index([checkedOutByUserId])
  @@map("appointments")
}

model ProfessionalCancellationFee {
  id             String       @id @default(cuid())
  companyId      String
  appointmentId  String       @unique
  professionalId String
  unitId         String
  amount         Decimal      @db.Decimal(10, 2)
  createdAt      DateTime     @default(now())
  appointment    Appointment  @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  company        Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  professional   Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  unit           Unit         @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([companyId, createdAt])
  @@index([professionalId, createdAt])
  @@index([unitId, createdAt])
  @@map("professional_cancellation_fees")
}

model Product {
  id                     String                   @id @default(cuid())
  companyId              String
  unitId                 String
  name                   String
  imageUrl               String
  description            String
  price                  Decimal                  @db.Decimal(10, 2)
  professionalPercentage Int
  category               String
  isActive               Boolean                  @default(true)
  isFeatured             Boolean                  @default(false)
  stockQuantity          Int                      @default(0)
  pickupDeadlineDays     Int                      @default(2)
  birthdayBenefitEnabled Boolean                  @default(false)
  birthdayPriceLevel     CustomerLevel?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @default(now())
  orderItems             OrderItem[]
  discounts              ProductDiscountByLevel[]
  sales                  ProductSale[]
  company                Company                  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  unit                   Unit                     @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([unitId])
  @@index([isFeatured])
  @@map("products")
}

model ProductDiscountByLevel {
  id          String        @id @default(cuid())
  companyId   String
  productId   String
  level       CustomerLevel
  discountPct Int           @default(0)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  company     Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  product     Product       @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, level])
  @@index([companyId])
  @@index([level])
  @@map("product_prices_by_level")
}

model ProductSale {
  id             String       @id @default(cuid())
  companyId      String
  unitId         String
  productId      String
  professionalId String
  quantity       Int
  unitPrice      Decimal      @db.Decimal(10, 2)
  totalPrice     Decimal      @db.Decimal(10, 2)
  soldAt         DateTime     @default(now())
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  company        Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  product        Product      @relation(fields: [productId], references: [id])
  professional   Professional @relation(fields: [professionalId], references: [id])
  unit           Unit         @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([unitId])
  @@index([productId])
  @@index([professionalId])
  @@index([soldAt])
  @@map("product_sales")
}

model Order {
  id                  String        @id @default(cuid())
  companyId           String
  unitId              String
  clientId            String?
  appointmentId       String?       @unique
  professionalId      String?
  status              OrderStatus   @default(PENDING)
  reservedUntil       DateTime?
  expiredAt           DateTime?
  inventoryRevertedAt DateTime?
  totalAmount         Decimal       @default(0) @db.Decimal(10, 2)
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  items               OrderItem[]
  appointment         Appointment?  @relation("AppointmentOrder", fields: [appointmentId], references: [id])
  client              User?         @relation(fields: [clientId], references: [id])
  company             Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)
  professional        Professional? @relation(fields: [professionalId], references: [id])
  unit                Unit          @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([unitId])
  @@index([clientId])
  @@index([appointmentId])
  @@index([professionalId])
  @@map("orders")
}

model OrderItem {
  id         String   @id @default(cuid())
  companyId  String
  orderId    String
  productId  String?
  serviceId  String?
  quantity   Int      @default(1)
  unitPrice  Decimal  @db.Decimal(10, 2)
  totalPrice Decimal  @db.Decimal(10, 2)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  company    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  order      Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product    Product? @relation(fields: [productId], references: [id])
  service    Service? @relation(fields: [serviceId], references: [id])

  @@index([companyId])
  @@index([orderId])
  @@index([productId])
  @@index([serviceId])
  @@map("order_items")
}

model Expense {
  id          String          @id @default(cuid())
  companyId   String
  unitId      String
  description String
  category    ExpenseCategory
  amount      Decimal         @db.Decimal(10, 2)
  dueDate     DateTime
  isRecurring Boolean         @default(false)
  isPaid      Boolean         @default(false)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @default(now())
  company     Company         @relation(fields: [companyId], references: [id], onDelete: Cascade)
  unit        Unit            @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([unitId])
  @@index([dueDate])
  @@map("expenses")
}

model ProfessionalWeeklyAvailability {
  id             String                           @id @default(cuid())
  companyId      String
  professionalId String
  unitId         String
  weekday        Int
  isActive       Boolean                          @default(true)
  createdAt      DateTime                         @default(now())
  updatedAt      DateTime                         @updatedAt
  company        Company                          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  professional   Professional                     @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  unit           Unit                             @relation(fields: [unitId], references: [id], onDelete: Cascade)
  intervals      ProfessionalWeeklyTimeInterval[]

  @@unique([professionalId, unitId, weekday])
  @@index([companyId])
  @@index([unitId])
  @@index([professionalId, weekday])
  @@map("professional_weekly_availabilities")
}

model ProfessionalWeeklyTimeInterval {
  id                   String                         @id @default(cuid())
  weeklyAvailabilityId String
  startTime            String
  endTime              String
  createdAt            DateTime                       @default(now())
  updatedAt            DateTime                       @updatedAt
  weeklyAvailability   ProfessionalWeeklyAvailability @relation(fields: [weeklyAvailabilityId], references: [id], onDelete: Cascade)

  @@map("professional_weekly_time_intervals")
}

model ProfessionalDailyAvailability {
  id             String                            @id @default(cuid())
  companyId      String
  professionalId String
  unitId         String
  date           DateTime
  type           ProfessionalDailyAvailabilityType
  createdAt      DateTime                          @default(now())
  updatedAt      DateTime                          @updatedAt
  company        Company                           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  professional   Professional                      @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  unit           Unit                              @relation(fields: [unitId], references: [id], onDelete: Cascade)
  intervals      ProfessionalDailyTimeInterval[]

  @@unique([professionalId, unitId, date])
  @@index([companyId])
  @@index([unitId])
  @@index([professionalId, date])
  @@map("professional_daily_availabilities")
}

model ProfessionalDailyTimeInterval {
  id                  String                        @id @default(cuid())
  dailyAvailabilityId String
  startTime           String
  endTime             String
  createdAt           DateTime                      @default(now())
  updatedAt           DateTime                      @updatedAt
  dailyAvailability   ProfessionalDailyAvailability @relation(fields: [dailyAvailabilityId], references: [id], onDelete: Cascade)

  @@map("professional_daily_time_intervals")
}

model AppointmentReview {
  id                         String                 @id @default(cuid())
  companyId                  String
  appointmentId              String                 @unique
  clientId                   String
  professionalId             String
  rating                     Int
  comment                    String?
  isAnonymousForProfessional Boolean                @default(false)
  createdAt                  DateTime               @default(now())
  updatedAt                  DateTime               @updatedAt
  tags                       AppointmentReviewTag[]
  appointment                Appointment            @relation(fields: [appointmentId], references: [id])
  client                     User                   @relation(fields: [clientId], references: [id])
  company                    Company                @relation(fields: [companyId], references: [id], onDelete: Cascade)
  professional               Professional           @relation(fields: [professionalId], references: [id])

  @@index([companyId])
  @@index([clientId])
  @@index([professionalId])
  @@map("appointment_reviews")
}

model ReviewTag {
  id         String                 @id @default(cuid())
  companyId  String
  label      String
  isActive   Boolean                @default(true)
  isNegative Boolean                @default(false)
  createdAt  DateTime               @default(now())
  updatedAt  DateTime               @updatedAt
  reviews    AppointmentReviewTag[]
  company    Company                @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([companyId, label])
  @@index([companyId])
  @@map("review_tags")
}

model AppointmentReviewTag {
  id        String            @id @default(cuid())
  reviewId  String
  tagId     String
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  review    AppointmentReview @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  tag       ReviewTag         @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([reviewId, tagId])
  @@index([tagId])
  @@map("appointment_review_tags")
}

model AdminAccess {
  id                     String   @id @default(cuid())
  companyId              String
  userId                 String
  unitId                 String?
  canAccessDashboard     Boolean  @default(false)
  canAccessReports       Boolean  @default(false)
  canAccessCheckout      Boolean  @default(false)
  canAccessAppointments  Boolean  @default(false)
  canAccessProfessionals Boolean  @default(false)
  canAccessServices      Boolean  @default(false)
  canAccessReviews       Boolean  @default(false)
  canAccessProducts      Boolean  @default(false)
  canAccessClients       Boolean  @default(false)
  canAccessClientLevels  Boolean  @default(false)
  canAccessFinance       Boolean  @default(false)
  canAccessSettings      Boolean  @default(false)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  company                Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  unit                   Unit?    @relation(fields: [unitId], references: [id])
  user                   User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([companyId, userId])
  @@index([companyId])
  @@index([unitId])
  @@index([userId])
  @@map("admin_access")
}

model AdminUnitAccess {
  id        String   @id @default(cuid())
  companyId String
  userId    String
  unitId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  unit    Unit    @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@unique([companyId, userId, unitId])
  @@index([companyId])
  @@index([userId])
  @@index([unitId])
  @@map("admin_unit_access")
}

model AnalyticsEvent {
  id               String   @id @default(cuid())
  companyId        String?
  userId           String?
  unitId           String?
  name             String
  ts               DateTime @default(now())
  source           String?
  pushId           String?
  pushType         String?
  secondsSincePush Int?
  payload          Json?
  context          Json?
  ip               String?
  userAgent        String?
  createdAt        DateTime @default(now())
  company          Company? @relation(fields: [companyId], references: [id])
  unit             Unit?    @relation(fields: [unitId], references: [id])
  user             User?    @relation(fields: [userId], references: [id])

  @@index([companyId, createdAt])
  @@index([unitId, createdAt])
  @@index([userId, createdAt])
  @@index([name, createdAt])
  @@map("analytics_events")
}

enum Role {
  CLIENT
  PROFESSIONAL
  ADMIN
}

enum CompanySegment {
  BARBERSHOP
  AESTHETIC
}

enum CompanyMemberRole {
  OWNER
  ADMIN
  STAFF
  CLIENT
}

enum AppointmentStatus {
  PENDING
  DONE
  CANCELED
}

enum ProfessionalDailyAvailabilityType {
  DAY_OFF
  CUSTOM
}

enum ExpenseCategory {
  RENT
  UTILITIES
  TAXES
  SUPPLIES
  OTHER
}

enum ClientPlanStatus {
  ACTIVE
  EXPIRED
  CANCELED
}

enum OrderStatus {
  PENDING
  PENDING_CHECKIN
  EXPIRED
  COMPLETED
  CANCELED
}

enum CustomerLevel {
  BRONZE
  PRATA
  OURO
  DIAMANTE
}

enum CustomerLevelRuleType {
  HAS_ACTIVE_PLAN
}
